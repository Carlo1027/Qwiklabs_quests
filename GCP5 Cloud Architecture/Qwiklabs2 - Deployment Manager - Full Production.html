<!DOCTYPE html>
<html lang='en'>
<head>
<meta content='[]' name='active-experiments'>
<meta content='{&quot;userId&quot;:2485272}' name='help-api-product-data'>
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="+1fm7/QXNaHuU56F73jltrMGqHWezGV+JthcUdgeo0YPYgYMN9L8CNrtYvnA3MTXJLnj8ccq7KbNmIGS5Pa6Hg==" />
<title>Deployment Manager - Full Production | Qwiklabs</title>
<meta content='width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=0' name='viewport'>
<meta content='In this lab you will launch a service using Deployment Manager, and monitor it using Cloud Monitoring. You will set up basic black box monitoring with Cloud Monitoring Dashboard and establish uptime check alert notification to trigger incident response.' name='description'>
<meta content='Qwiklabs' name='author'>
<meta content='1rRsY0INj8RvwB5EF5pwdxt2A2P9aDgAlsICaJ0d5w0' name='google-site-verification'>
<meta content='Deployment Manager - Full Production | Qwiklabs' property='og:title'>
<meta content='website' property='og:type'>
<meta content='/favicon-144.png' property='og:image'>
<meta content='Qwiklabs' property='og:site_name'>
<meta content='In this lab you will launch a service using Deployment Manager, and monitor it using Cloud Monitoring. You will set up basic black box monitoring with Cloud Monitoring Dashboard and establish uptime check alert notification to trigger incident response.' property='og:description'>
<meta content='/qwiklabs_logo_900x887.png' property='og:logo' size='900x887'>
<meta content='/qwiklabs_logo_994x187.png' property='og:logo' size='994x187'>
<meta content='#3681E4' property='msapplication-TileColor'>
<meta content='/favicon-144.png' property='msapplication-TileImage'>
<link href='/favicon-32.png' rel='shortcut icon'>
<link color='#3681E4' href='/favicon-svg.svg' rel='mask-icon'>
<link href='/favicon-180.png' rel='apple-touch-icon-precomposed'>
<link rel="stylesheet" media="screen" href="https://fonts.googleapis.com/css?family=Oswald:400|Roboto+Mono:400,700|Roboto:300,400,500,700|Google+Sans:300,400,500,700|Google+Sans+Display:400|Material+Icons|Google+Material+Icons" />


<!--[if lt IE 9]>
<script src='http://html5shim.googlecode.com/svn/trunk/html5.js' type='text/javascript'></script>
<![endif]-->
<!--[endif]>  <![endif]-->
<script>
//<![CDATA[
window.gon={};gon.current_user={"firstname":"Carlo Andr\u00e9","lastname":"Castro Galindo","fullname":"Carlo Andr\u00e9 Castro Galindo","company":"Coursera","email":"carlocastrogalindo@gmail.com","origin":"googlecoursera-run, lti-coursera","subscriptions":1,"id":"eb3f0602d940d94d2eaeef36f2aa2e77","qlCreatedAt":"2020-02-28 17:36:48 UTC","optIn":false};gon.segment="j4Im8pqIko0Lxq4wVVZWMPMM0EroHUvb";gon.deployment="run";
//]]>
</script>
<script type='application/ld+json'>
{
  "@context": "http://schema.org",
  "@type": "WebSite",
  "url": "https://www.qwiklabs.com/",
  "potentialAction": {
    "@type": "SearchAction",
    "target": "https://www.qwiklabs.com/catalog?keywords={search_term_string}",
    "query-input": "required name=search_term_string"
  }
}
</script>
<script id='ze-snippet' src='https://static.zdassets.com/ekr/snippet.js?key=511e4158-0aec-4e3c-b2e6-4daa1769f51e'></script>



<link rel="stylesheet" media="all" href="https://cdn.qwiklabs.com/assets/application-24120c1aef38a3b99b2e86e178f8f60bb0e27812dc7adfea7b9339d8f1fd09b0.css" />
<script>
  EVENT_SOURCE_BASE_URL = "https://run.qwiklabs.com/nchan-sub?id=";
</script>
<script src="https://cdn.qwiklabs.com/polyfills/webcomponents-loader.js"></script>
<script src="https://cdn.qwiklabs.com/assets/hallofmirrors/hallofmirrors-f85649837b49ca7f1e74eb3f73279677cceab3c00277677d234942f2a30157a1.js"></script>
<script src="https://www.youtube.com/iframe_api"></script>
<script src="https://cdn.qwiklabs.com/assets/vendor-45d462772c30000424907184f70c7157e95fb6227698d1671c5051818a6f60d8.js"></script>
<script src="https://cdn.qwiklabs.com/assets/application-7c67c1d428839917a0992758b33da63184c69efa420e5939804ea34d54147a97.js"></script>
</head>
<body class='focuses focuses-show lab-show l-full no-nav'>
<div class='header-container light-theme'>
<div class='header'>
<a class='mdl-button mdl-button--icon mdl-js-button mdl-js-ripple-effect header__button header__button--nav header__nav-panel-button js-nav-toggle'>
<i class='material-icons'>menu</i>
</a>
<div class='header__title'>
<a class="mdl-button mdl-js-button mdl-button--icon mdl-js-ripple-effect header__button header__button--nav" href="https://www.qwiklabs.com/quests/24"><ql-icon>arrow_back</ql-icon></a>

<h1 class='headline-5'>
Deployment Manager - Full Production
</h1>
</div>
<div class='header__actions'>
<a class='mdl-button mdl-js-button mdl-button--icon mdl-js-ripple-effect header__button header__button--action header__button--search js-header-search-bar-button'>
<i class='material-icons'>search</i>
</a>
<a class="mdl-button mdl-button--icon mdl-js-button mdl-js-ripple-effect" id="toggle-lab-control-panel" href="javascript:;"><i class='material-icons'>description</i>
</a><div class='mdl-tooltip js-tooltip' data-mdl-for='toggle-lab-control-panel'>
Toggle Lab Panel
</div>
<a class="mdl-button mdl-button--icon mdl-js-button mdl-js-ripple-effect js-favorite-button favorite-button" id="CatalogItem-981-favorite-button" data-type="CatalogItem" data-id="981" data-name="Deployment Manager - Full Production" href="/favorite.json?item_id=981&amp;item_type=CatalogItem"><i class='material-icons'>favorite_border</i>
</a><div class='mdl-tooltip js-tooltip' for='CatalogItem-981-favorite-button'>
Add to favorites
</div>


<ql-help context="lab" productdata="{&quot;userId&quot;:2485272}" data-analytics-action="opened_help" data-analytics-label="lab"></ql-help>
<a class='header-my-account-button mdl-button mdl-button--icon mdl-js-button mdl-js-ripple-effect js-my-account-button'>
<img class="avatar " alt="avatar image" src="https://secure.gravatar.com/avatar/be719396bbcc1e8bcb204a54e1920c54.png?s=80&amp;d=mm" />
</a>
<div class='header-my-account-menu js-my-account-menu'>
<div class='card elevation-2 no-padding'>
<div class='my-account-menu__top'>
<img class="avatar " alt="avatar image" src="https://secure.gravatar.com/avatar/be719396bbcc1e8bcb204a54e1920c54.png?s=80&amp;d=mm" />
<div class='my-account-menu__info'>
<h4 class='subtitle-headline-1'>
Carlo Andr√© Castro Galindo
</h4>
<p class='body-2 text--gray'>
<span>carlocastrogalindo@gmail.com</span>
</p>
<a class="button" href="/my_account/profile">My Account</a>
</div>
</div>
<div class='my-account-menu__bottom'>
<a class="text--green subtitle-headline-2" href="/my_account/credits">Monthly Subscription
</a><a data-analytics-action="clicked_sign_out" class="button button--hairline" rel="nofollow" data-method="delete" href="/users/sign_out">Sign Out</a>
</div>
</div>
</div>

</div>
</div>
<div class='header__search-bar js-header-search-bar'>
<form id="catalog-search-mobile" onsubmit="ql.catalogSearchFilter(); return false;" action="/searches/elasticsearch" accept-charset="UTF-8" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><input type="hidden" name="authenticity_token" value="l7v41VOm/t1kxbBsBmPtq4a/COL2Fs/st1ZRpJDRdP5jjhg2kGM3dFB7TBApx8zKEQBDZq/wRjRcFoxnrDltpg==" />
<input type="text" name="keywords" id="keywords" placeholder="Search" maxlength="255" aria-label="catalog search bar" />
</form>

<a class='mdl-button mdl-js-button mdl-button--icon mdl-js-ripple-effect header__button'>
<i class='material-icons'>close</i>
</a>
</div>
</div>

<nav class='nav-bar'>
<a class="nav-bar__item js-navigation-button" href="/"><ql-icon class='nav-bar__item__icon'>
home
</ql-icon>
<span class='nav-bar__item__label'>
Home
</span>
</a>
<a class="nav-bar__item js-navigation-button  active" aria-current="page" href="/catalog"><ql-icon class='nav-bar__item__icon'>
school
</ql-icon>
<span class='nav-bar__item__label'>
Catalog
</span>
</a>
<a class="nav-bar__item js-navigation-button" href="/my_learning"><ql-icon class='nav-bar__item__icon'>
event_note
</ql-icon>
<span class='nav-bar__item__label'>
My Learning
</span>
</a>
</nav>

<nav class='nav-panel js-nav-panel'>
<div class='nav-panel__logo'>
<div class='logo logo--blue'></div>
</div>
<a title="Home" tabindex="-1" class="nav-panel__item js-navigation-button" href="/"><ql-icon class='nav-panel__item__icon'>
home
</ql-icon>
<div class='nav-panel__item__label'>
Home
</div>
</a>
<a title="Catalog" tabindex="-1" class="nav-panel__item js-navigation-button active" aria-current="page" href="/catalog"><ql-icon class='nav-panel__item__icon'>
school
</ql-icon>
<div class='nav-panel__item__label'>
Catalog
</div>
</a>
<a title="My Learning" tabindex="-1" class="nav-panel__item js-navigation-button" href="/my_learning"><ql-icon class='nav-panel__item__icon'>
event_note
</ql-icon>
<div class='nav-panel__item__label'>
My Learning
</div>
</a>
<div class='nav-panel__spacer'></div>
<a title="Profile" tabindex="-1" class="nav-panel__item js-navigation-button" href="/my_account/profile"><ql-icon class='nav-panel__item__icon'>
account_circle
</ql-icon>
<div class='nav-panel__item__label'>
Profile
</div>
</a>
<a title="Credits &amp; Subscriptions" tabindex="-1" class="nav-panel__item js-navigation-button" href="/my_account/credits"><ql-icon class='nav-panel__item__icon'>
money
</ql-icon>
<div class='nav-panel__item__label'>
Credits &amp; Subscriptions
</div>
</a>
<a title="Security" tabindex="-1" class="nav-panel__item js-navigation-button" href="/my_account/security"><ql-icon class='nav-panel__item__icon'>
security
</ql-icon>
<div class='nav-panel__item__label'>
Security
</div>
</a>
<div class='nav-panel__spacer'></div>
<a class="nav-panel__item" tabindex="-1" href="#"><ql-help>
<div class='nav-panel__help-item'>
<ql-icon class='nav-panel__item__icon'>help</ql-icon>
<div class='nav-panel__item__label'>Help</div>
</div>
</ql-help>
</a><div class='nav-panel__small-links'>
<a tabindex="-1" href="/privacy_policy">Privacy</a>
<a tabindex="-1" href="/terms_of_service">Terms</a>
</div>
</nav>
<div class='nav-panel__overlay js-nav-toggle'></div>

<main class='js-main'>
<span class='hidden' id='flash-sibling-before'></span>

<div class='l-main-wrapper' id='main-wrapper'>







<div class='js-lab-state' data-analytics-payload='{&quot;label&quot;:&quot;Deployment Manager - Full Production&quot;,&quot;lab_name&quot;:&quot;Deployment Manager - Full Production&quot;,&quot;classroom_name&quot;:null,&quot;deployment&quot;:&quot;run&quot;}' data-focus-id='981' data-lab-billing-limit='0.0' data-lab-duration='5400' data-parent='catalog' data-payment-required></div>
<ql-lab-control-panel class='js-lab-control-panel l-lab-control-panel' connectionDetails='[]' connectionFiles='[]' labControlButton='{&quot;disabled&quot;:false,&quot;pending&quot;:false,&quot;running&quot;:false}' labTimer='{&quot;ticking&quot;:false,&quot;secondsRemaining&quot;:5400}' studentResources='[]'></ql-lab-control-panel>
<div class='l-lab-main-body'>
<div class='js-lab-content lab-content'>
<div class='alert alert--fake js-alert'>
<p class='alert__message js-alert-message'></p>
<a class='alert__close js-alert-close'>
<i class='fa fa-times'></i>
</a>
<iframe class='l-ie-iframe-fix'></iframe>
</div>
<div class='lab-content__markdown-wrapper'>
<div class='lab-preamble'>
<h1 class='lab-preamble__title'>
Deployment Manager - Full Production
</h1>
<div class='lab-preamble__details subtitle-headline-1'>
<span>1 hour 30 minutes</span>
<span>9 Credits</span>
<div class='lab__rating'>
<a href="/focuses/981/reviews?parent=catalog"><div class='rateit' data-rateit-readonly='true' data-rateit-value='4.2723'></div>

</a><a data-target='#lab-review-modal' data-toggle='modal'>
Rate Lab
</a>
</div>
</div>
</div>

<div class='lab-content__inner-wrapper'>
<div class='js-markdown-instructions lab-content__markdown markdown-lab-instructions' id='markdown-lab-instructions'>



<h2 id="step1">GSP060</h2>
<p><img alt="Google Cloud Self-Paced Labs" src="https://cdn.qwiklabs.com/GMOHykaqmlTHiqEeQXTySaMXYPHeIvaqa2qHEzw6Occ%3D"></p>

<h2 id="step2">Overview</h2>
<p>In this lab, you launch a service using an infrastructure orchestration tool called Deployment Manager and monitor the service using Cloud Monitoring. In Cloud Monitoring, you set up basic black box monitoring with a Cloud Monitoring dashboard and establish an Uptime Check (alert notification) to trigger incident response.</p>
<p>More specifically, you:</p>
<ol>
<li>Install and configure an advanced deployment using Deployment Manager sample templates.</li>
<li>Enable Cloud Monitoring.</li>
<li>Configure Cloud Monitoring Uptime Checks and notifications.</li>
<li>Configure a Cloud Monitoring dashboard with two charts, one showing CPU usage and the other ingress traffic.</li>
<li>Perform a load test and simulate a service outage.</li>
</ol>
<p>Cloud Monitoring provides visibility into the performance, uptime, and overall health of cloud-powered applications.It collects metrics, events, and metadata from Google Cloud, Amazon Web Services, hosted uptime probes, application instrumentation, and a variety of common application components including Cassandra, Nginx, Apache Web Server, Elasticsearch, and many others. Cloud Monitoring ingests that data and generates insights via dashboards, charts, and alerts. Cloud Monitoring alerting helps you collaborate by integrating with Slack, PagerDuty, HipChat, Campfire, and more.</p>
<h2 id="step3">Objectives</h2>
<p>In this lab, you learn to:</p>
<ul>
<li>
<p>Launch a cloud service from a collection of templates.</p>
</li>
<li>
<p>Configure basic black box monitoring of an application.</p>
</li>
<li>
<p>Create an uptime check to recognize a loss of service.</p>
</li>
<li>
<p>Establish an alerting policy to trigger incident response procedures.</p>
</li>
<li>
<p>Create and configure a dashboard with dynamically updated charts.</p>
</li>
<li>
<p>Test the monitoring and alerting regimen by applying a load  to the service.</p>
</li>
<li>
<p>Test the monitoring and alerting regimen by simulating a service outage.</p>
</li>
</ul>
<h2 id="step4">Setup and Requirements</h2>
<h4>Before you click the Start Lab button</h4>
<p>Read these instructions. Labs are timed and you cannot pause them. The timer, which starts when you click <strong>Start Lab</strong>, shows how long Google Cloud resources will be made available to you.</p>
<p>This Qwiklabs hands-on lab lets you do the lab activities yourself in a real cloud environment, not in a simulation or demo environment. It does so by giving you new, temporary credentials that you use to sign in and access Google Cloud for the duration of the lab.</p>
<h4>What you need</h4>
<p>To complete this lab, you need:</p>
<ul>
<li>Access to a standard internet browser (Chrome browser recommended).</li>
<li>Time to complete the lab.</li>
</ul>
<p><strong>Note:</strong> If you already have your own personal Google Cloud account or project, do not use it for this lab.</p>
<p><strong>Note:</strong> If you are using a Pixelbook please open an Incognito window to run this lab.</p>

<h4>How to start your lab and sign in to the Google Cloud Console</h4>
<ol>
<li>
<p>Click the <strong>Start Lab</strong> button. If you need to pay for the lab, a pop-up opens for you to select your payment method.
On the left is a panel populated with the temporary credentials that you must use for this lab.</p>
<p><img alt="Open Google Console" src="https://cdn.qwiklabs.com/%2FtHp4GI5VSDyTtdqi3qDFtevuY014F88%2BFow%2FadnRgE%3D"></p>
</li>
<li>
<p>Copy the username, and then click <strong>Open Google Console</strong>.
The lab spins up resources, and then opens another tab that shows the <strong>Sign in</strong> page.</p>
<p><img alt="Sign in" src="https://cdn.qwiklabs.com/VkUIAFY2xX3zoHgmWqYKccRLwFrR4BfARLd5ojmlbhs%3D"></p>
<p><strong><em>Tip:</em></strong> Open the tabs in separate windows, side-by-side.</p>
<aside>
 If you see the <strong>Choose an account</strong> page, click <strong>Use Another Account</strong>.
<img alt="Choose an account" src="https://cdn.qwiklabs.com/eQ6xPnPn13GjiJP3RWlHWwiMjhooHxTNvzfg1AL2WPw%3D">
</aside>
</li>
<li>
<p>In the <strong>Sign in</strong> page, paste the username that you copied from the Connection Details panel. Then copy and paste the password.</p>
<p><strong><em>Important:</em></strong> You must use the credentials from the Connection Details panel. Do not use your Qwiklabs credentials. If you have your own Google Cloud account, do not use it for this lab (avoids incurring charges).</p>
</li>
<li>
<p>Click through the subsequent pages:</p>
<ul>
<li>Accept the terms and conditions.</li>
<li>Do not add recovery options or two-factor authentication (because this is a temporary account).</li>
<li>Do not sign up for free trials.</li>
</ul>
</li>
</ol>
<p>After a few moments, the Cloud Console opens in this tab.</p>
<aside>
<strong>Note:</strong> You can view the menu with a list of Google Cloud Products and Services by clicking the <strong>Navigation menu</strong> at the top-left.
<img alt="Cloud Console Menu" src="https://cdn.qwiklabs.com/9vT7xPlxoNP%2FPsK0J8j0ZPFB4HnnpaIJVCDByaBrSHg%3D">
</aside>

<h3>Activate Google Cloud Shell</h3>
<p>Google Cloud Shell is a virtual machine that is loaded with development tools. It offers a persistent 5GB home directory and runs on the Google Cloud.
Google Cloud Shell provides command-line access to your Google Cloud resources.</p>
<ol>
<li>
<p>In the Google Cloud Console, on the top right toolbar, click the <strong>Activate Cloud Shell</strong> button.</p>
<p><img alt="Cloud Shell icon" src="https://cdn.qwiklabs.com/vdY5e%2Fan9ZGXw5a%2FZMb1agpXhRGozsOadHURcR8thAQ%3D"></p>
</li>
<li>
<p>Click <strong>Continue</strong>.
<img alt="cloudshell_continue.png" src="https://cdn.qwiklabs.com/lr3PBRjWIrJ%2BMQnE8kCkOnRQQVgJnWSg4UWk16f0s%2FA%3D"></p>
</li>
</ol>
<p>It takes a few moments to provision and connect to the environment. When you are connected, you are already authenticated, and the project is set to your <em>PROJECT_ID</em>. For example:</p>
<p><img alt="Cloud Shell Terminal" src="https://cdn.qwiklabs.com/hmMK0W41Txk%2B20bQyuDP9g60vCdBajIS%2B52iI2f4bYk%3D"></p>
<p><strong>gcloud</strong> is the command-line tool for Google Cloud. It comes pre-installed on Cloud Shell and supports tab-completion.</p>
<p>You can list the active account name with this command:</p>
<pre><code>gcloud auth list&#x000A;</code></pre>
<p>Output:</p>
<pre><code class="language-output prettyprint">Credentialed accounts:&#x000A; - &lt;myaccount&gt;@&lt;mydomain&gt;.com (active)&#x000A;</code></pre>
<p>Example output:</p>
<pre><code class="language-Output prettyprint">Credentialed accounts:&#x000A; - google1623327_student@qwiklabs.net&#x000A;</code></pre>
<p>You can list the project ID with this command:</p>
<pre><code>gcloud config list project&#x000A;</code></pre>
<p>Output:</p>
<pre><code class="language-output prettyprint">[core]&#x000A;project = &lt;project_ID&gt;&#x000A;</code></pre>
<p>Example output:</p>
<pre><code class="language-Output prettyprint">[core]&#x000A;project = qwiklabs-gcp-44776a13dea667a6&#x000A;</code></pre>
<aside>
  For full documentation of <strong>gcloud</strong>, see <a href="https://cloud.google.com/sdk/gcloud" target="_blank">gcloud command-line tool overview</a>.

</aside>

<h2 id="step5">Create a virtual environment</h2>
<p>Execute the following command to download and update the packages list.</p>
<pre><code>sudo apt-get update&#x000A;</code></pre>
<p>Python virtual environments are used to isolate package installation from the system.</p>
<pre><code>sudo apt-get install virtualenv&#x000A;</code></pre>
<ql-infobox>If prompted [Y/n], press <code>Y</code> and then <code>Enter</code>.</ql-infobox>
<pre><code>virtualenv -p python3 venv&#x000A;</code></pre>
<p>Activate the virtual environment.</p>
<pre><code>source venv/bin/activate&#x000A;</code></pre>

<h2 id="step6">Clone the Deployment Manager Sample Templates</h2>
<p>Google provides a robust set of sample Deployment Manager templates that you can learn from and build upon.</p>
<p>To clone the repository, enter the following commands in Cloud Shell Command Line to create a directory to hold the Deployment Manager sample templates.</p>
<pre><code>mkdir ~/dmsamples&#x000A;</code></pre>
<p>Go to that directory.</p>
<pre><code>cd ~/dmsamples&#x000A;</code></pre>
<p>Clone the repository to the directory you just made.</p>
<pre><code>git clone https://github.com/GoogleCloudPlatform/deploymentmanager-samples.git&#x000A;</code></pre>
<p><strong>Example Output:</strong></p>
<pre><code class="language-bash prettyprint">remote: Counting objects: 1917, done.&#x000A;remote: Compressing objects: 100% (31/31), done.&#x000A;remote: Total 1917 (delta 11), reused 29 (delta 7), pack-reused 1874&#x000A;Receiving objects: 100% (1917/1917), 426.86 KiB | 0 bytes/s, done.&#x000A;Resolving deltas: 100% (1060/1060), done.&#x000A;</code></pre>
<h2 id="step7">Explore the Sample Files</h2>
<p>We just downloaded a collection of sample templates to our directory, let's dive in and explore some of them.</p>
<h3>List the example templates</h3>
<p>Run the following commands to navigate to and list the version2 examples:</p>
<pre><code>cd ~/dmsamples/deploymentmanager-samples/examples/v2&#x000A;</code></pre>
<pre><code>ls&#x000A;</code></pre>
<p>You should see something like this:</p>
<pre><code class="language-bash prettyprint">access_context_manager  cloud_functions  common               folder_creation  iam_custom_role  internal_lb_haproxy  quick_start   ssl                 vm_with_disks&#x000A;access_control          cloudkms         container_igm        gke              igm-updater      metadata_from_file   regional_igm  step_by_step_guide  vpn_auto_subnet&#x000A;bigtable                cloud_router     container_vm         ha-service       image_based_igm  nodejs               saltstack     template_modules    waiter&#x000A;build_configuration     cloudsql         custom_machine_type  htcondor         instance_pool    nodejs_l7            single_vm     vlan_attachment&#x000A;cloudbuild              cloudsql_import  dataproc             iam              internal_lb      project_creation     sqladmin      vm_startup_script&#x000A;</code></pre>
<p>Not all of the subdirectories are independent projects. For example, the directory named <strong>common</strong> contains templates that are used by several of the other projects. If you are studying independently later, use the <code>README</code> files as a guide.</p>
<p>The <code>nodejs</code> directory contains everything you need to build this lab. Note that there is a <code>nodejs</code> directory and a <code>nodejs_l7</code>directory. Use <code>nodejs</code>.</p>
<h3>List and examine the Nodejs deployment</h3>
<p>Navigate to and list the version2 examples:</p>
<pre><code>cd nodejs/python&#x000A;</code></pre>
<pre><code>ls&#x000A;</code></pre>
<p><strong>Example Output:</strong></p>
<pre><code class="language-bash prettyprint">frontend.py  frontend.py.schema  nodejs.py  nodejs.py.schema  nodejs.yaml&#x000A;</code></pre>
<p>The main deployment manager configuration file is <code>nodejs.yaml</code>. It makes use of templates to generate infrastructure. The rest of the files are templates. Templates use variables defined in the <code>nodejs</code>.<code>yaml</code> configuration file to produce customized results.</p>
<p><img alt="bb0ba9fa2750ba43.png" src="https://cdn.qwiklabs.com/40UqXM4XpfPlZ%2BOQWaVadL5q1cNctNoC2OHvAS3pxsw%3D"></p>
<h3>frontend.py</h3>
<p><code>frontend.py</code> includes <code>frontend.py.schema</code>, which creates an instance template based on <code>container_instance_template.py</code>. This template is used to create a managed instance group and an autoscaler. The template also creates a network load balancer that has a forwarding rule with a single public IP address. It also creates:</p>
<ul>
<li>
<p>A target pool that refers to the managed instance group.</p>
</li>
<li>
<p>A health check attached to the target pool.</p>
</li>
</ul>
<h3>nodejs.py</h3>
<p><code>nodejs.py</code> includes <code>nodejs.py.schema</code>, which brings the frontend and backend templates together.</p>
<ul>
<li>
<p>Note that the frontend is <code>frontend.py</code>.</p>
</li>
<li>
<p>The backend is <code>/common/python/container_vm.py</code>.</p>
</li>
<li>
<p>This is a VM running a Docker container with MySQL, so it doesn't require a custom template.</p>
</li>
</ul>
<h3>Other files</h3>
<ul>
<li>
<p><code>/common/python/container_instance_template.py</code></p>
</li>
<li>
<p><code>/common/python/container_vm.py</code></p>
</li>
<li>
<p><code>/common/python/container_helper.py</code></p>
</li>
</ul>
<h2 id="step8">Customize the Deployment</h2>
<p>Now that you've downloaded and reviewed the <code>nodejs</code> Deployment Manager template, let's start customizing the deployment.</p>
<h3>Specify the zone</h3>
<p>The <code>nodejs.yaml</code> file requires a zone, and you'll now add one to the file.</p>
<ol>
<li>
<p>Enter the following command to open the list of zones:</p>
</li>
</ol>
<pre><code>gcloud compute zones list&#x000A;</code></pre>
<p>Copy the name of a zone for the configuration file to use.</p>
<ol start="2">
<li>
<p>Open <code>nodejs.yaml</code> in <code>nano</code> so you can edit the <code>zone</code> value:</p>
</li>
</ol>
<pre><code>nano nodejs.yaml&#x000A;</code></pre>
<p>The <code>nodejs.yaml</code> file contents:</p>
<pre><code class="language-bash prettyprint">resources:&#x000A;- name: nodejs&#x000A;  type: nodejs.py&#x000A;  properties:&#x000A;    zone: ZONE_TO_RUN&#x000A;</code></pre>
<ol start="3">
<li>Replace <code>ZONE_TO_RUN</code> with a zone name that's near you, then exit nano and save the file.</li>
</ol>
<p>This example shows <code>ZONE_TO_RUN</code> set to <code>us-east1-d</code></p>
<pre><code class="language-bash prettyprint">resources:&#x000A;- name: nodejs&#x000A;  type: nodejs.py&#x000A;  properties:&#x000A;    zone: us-east1-d&#x000A;</code></pre>
<h3>Modify the maximum number of instances in the instance group</h3>
<p>Edit the <code>nodejs.py</code> file.</p>
<ol>
<li>
<p>Enter this command to open <code>nodejs.py</code> in <code>nano</code>:</p>
</li>
</ol>
<pre><code>nano nodejs.py&#x000A;</code></pre>
<ol start="2">
<li>
<p>Verify current scaling limit for frontend in <code>nodejs.py</code></p>
</li>
</ol>
<pre><code>{&#x000A;     'name': frontend,&#x000A;     'type': 'frontend.py',&#x000A;     'properties': {&#x000A;         'zone': context.properties['zone'],&#x000A;         'dockerImage': 'gcr.io/deployment-manager-examples/nodejsservice',&#x000A;         'port': application_port,&#x000A;         # Define the variables that are exposed to container as env variables.&#x000A;         'dockerEnv': {&#x000A;             'SEVEN_SERVICE_MYSQL_PORT': mysql_port,&#x000A;             'SEVEN_SERVICE_PROXY_HOST': '$(ref.' + backend&#x000A;                                         + '.networkInterfaces[0].networkIP)'&#x000A;         },&#x000A;         # If left out will default to 1&#x000A;         'size': 2,&#x000A;         # If left out will default to 1&#x000A;         'maxSize': 20&#x000A;     }&#x000A; },&#x000A;</code></pre>
<p>Current scaling limit is 20 (refer maxSize).</p>
<ol start="3">
<li>
<p>Modify the <code>maxSize</code> and set it to 4:</p>
</li>
</ol>
<pre><code>{&#x000A;     'name': frontend,&#x000A;     'type': 'frontend.py',&#x000A;     'properties': {&#x000A;         'zone': context.properties['zone'],&#x000A;         'dockerImage': 'gcr.io/deployment-manager-examples/nodejsservice',&#x000A;         'port': application_port,&#x000A;         # Define the variables that are exposed to container as env variables.&#x000A;         'dockerEnv': {&#x000A;             'SEVEN_SERVICE_MYSQL_PORT': mysql_port,&#x000A;             'SEVEN_SERVICE_PROXY_HOST': '$(ref.' + backend&#x000A;                                         + '.networkInterfaces[0].networkIP)'&#x000A;         },&#x000A;         # If left out will default to 1&#x000A;         'size': 2,&#x000A;         # If left out will default to 1&#x000A;         'maxSize': 4&#x000A;     }&#x000A; },&#x000A;</code></pre>
<p>Save the file and exit nano when you're done.</p>
<h2 id="step9">Run the Application</h2>
<p>Now you'll use Deployment Manager to deploy the application and make it operational. This builds the infrastructure, but it won't allow traffic. After Deployment Manager sets up the infrastructure, you can apply service labels.</p>
<h3>Deploy the application</h3>
<p>Enter this command to name the application <code>advanced-configuration</code> and pass Deployment Manager the configuration file (<code>nodejs.yaml</code>).</p>
<pre><code>gcloud deployment-manager deployments create advanced-configuration --config nodejs.yaml&#x000A;</code></pre>
<p>Output:</p>
<pre><code class="language-bash prettyprint">The fingerprint of the deployment is PiYc6OsIFkWzQpCDklHvaA==&#x000A;Waiting for create [operation-1529913842103-56f72d31872d9-90070017-aec5761d]...done.&#x000A;Create operation operation-1529913842103-56f72d31872d9-90070017-aec5761d completed successfully.&#x000A;NAME                                   TYPE                             STATE      ERRORS  INTENT&#x000A;advanced-configuration-application-fw  compute.v1.firewall              COMPLETED  []&#x000A;advanced-configuration-backend         compute.v1.instance              COMPLETED  []&#x000A;advanced-configuration-frontend-as     compute.v1.autoscaler            COMPLETED  []&#x000A;advanced-configuration-frontend-hc     compute.v1.httpHealthCheck       COMPLETED  []&#x000A;advanced-configuration-frontend-igm    compute.v1.instanceGroupManager  COMPLETED  []&#x000A;advanced-configuration-frontend-it     compute.v1.instanceTemplate      COMPLETED  []&#x000A;advanced-configuration-frontend-lb     compute.v1.forwardingRule        COMPLETED  []&#x000A;advanced-configuration-frontend-tp     compute.v1.targetPool            COMPLETED  []&#x000A;</code></pre>
<p>Click <strong>Check my progress</strong> below to check your lab progress.</p>
<ql-activity-tracking step="1">
    Deploy the application
</ql-activity-tracking>
<p>Confirm the limit for the maximum number of instances:</p>
<ol>
<li>
<p>Go to <strong>Compute Engine</strong> &gt; <strong>Instance groups</strong>.</p>
<p><img alt="ComputeEngine_InstanceGroups.png" src="https://cdn.qwiklabs.com/VSe6QJCURyuBRtdwI1VmPbmtVO6lr%2BMBOVqSxBQ%2FR1o%3D"></p>
</li>
<li>
<p>Click on <strong>advanced-configuration-frontend-igm</strong>. <img alt="11990217fdad313e.png" src="https://cdn.qwiklabs.com/%2Bp3hZFvK7pLEz8wDzim4v9wdElPNp53neYOUXYA0OV0%3D"></p>
</li>
<li>
<p>Click on the Details tab, then verify the maximum number of instances.
<img alt="max-num.png" src="https://cdn.qwiklabs.com/P%2BEn0rirUUkLCkoMCWp2QJtHtGjaVqydNJNAphyJNZI%3D"></p>
</li>
</ol>
<p>You'll see it has been set to 4.</p>
<h2 id="step10">Verify that the application is operational</h2>
<p>The application takes a few minutes to start. You can view it in the Deployment Manager part of Cloud Console (<strong>Navigation menu</strong> &gt; <strong>Deployment Manager</strong>), or you can see the instances in the Compute Engine part of Console (<strong>Navigation menu</strong> &gt; <strong>Compute Engine</strong> &gt; <strong>VM</strong>).</p>
<p>To verify that the application is running, open a browser to access <code>port 8080</code> and view the service. Since the IP address was established dynamically when the Deployment Manager implemented the global forwarding rule (specified in the template), you'll need to find that address to test the application.</p>
<h3>Find the global load balancer forwarding rule IP address</h3>
<ol>
<li>
<p>Enter the following command in the Cloud Command Line to find your forwarding IP address.</p>
</li>
</ol>
<pre><code>gcloud compute forwarding-rules list&#x000A;</code></pre>
<p><strong>Example output:</strong></p>
<p><img alt="369c66095dd87ce8.png" src="https://cdn.qwiklabs.com/iTFyoWP0LBGcSOSQLoSTyfXuGX7UQdYCQNJLoXu415Q%3D">
Your forwarding IP address is the IP_ADDRESS listed in your output. Be sure to record it; you'll use it a few times in this lab.</p>
<ol start="2">
<li>
<p>Open a new window in your browser. In the address field, enter the following URL, replacing <code>&lt;your IP address&gt;</code> with your forwarding IP address:</p>
</li>
</ol>
<pre><code>http://&lt;your IP address&gt;:8080&#x000A;</code></pre>
<p>You see a blank page, similar to below, with your own IP address:</p>
<p><img alt="b0313bc2bc83fd85.png" src="https://cdn.qwiklabs.com/STpmChPe39xBddGAasxfBm%2BTsT5A425F6HG%2FMKQeBz0%3D"></p>
<p>It may take up to 10 minutes for the service to become operational. If you get an error, such as a 404, or a time out, wait about two minutes and try again.</p>
<ol start="3">
<li>
<p>Now enter log information by entering a log message in your browser address line.</p>
</li>
</ol>
<pre><code>http://&lt;your forwarding IP address&gt;:8080/?msg=&lt;enter_a_message&gt;&#x000A;</code></pre>
<p>Replace <code>enter_a_message</code> with any kind of message.</p>
<p>These are log message examples - you have a different IP address:</p>
<pre><code class="language-bash prettyprint">http://35.196.56.153:8080/?msg=my dog has spots&#x000A;</code></pre>
<p><img alt="dcbc4d400e96e650.png" src="https://cdn.qwiklabs.com/BaDXAVrIgQau%2F%2F1ym99jFfrWBd8xwAn7qZnOYGEgkLY%3D"></p>
<p>After you enter the log, the browser returns <code>added</code>.</p>
<p><img alt="d816761e8572a251.png" src="https://cdn.qwiklabs.com/9iHvic1MnaKJUnI%2Bf1pwgTnIdhHnYEcWLiGexXu5IJA%3D"></p>
<ol start="4">
<li>View the log by going to <code>http://&lt;your IP address&gt;:8080</code>. For example:</li>
</ol>
<p><img alt="7ce7917b8519c96d.png" src="https://cdn.qwiklabs.com/m7fbmMH6Z5acpT9%2F2ueDX5hOVMtdP7tlqAs0Axmj34I%3D"></p>
<p>Go ahead and create more logs and see them at <code>http://&lt;your IP address&gt;:8080</code>.</p>
<h2 id="step11">Configure an uptime check and alert policy in Cloud Monitoring</h2>
<h3>Create a Monitoring workspace</h3>
<p>You will now setup a Monitoring workspace that's tied to your Qwiklabs GCP Project. The following steps create a new account that has a free trial of Monitoring.</p>
<ol>
<li>
<p>In the Google Cloud Platform Console, click on <strong>Navigation menu</strong> &gt; <strong>Monitoring</strong>.</p>
</li>
<li>
<p>Wait for your workspace to be provisioned.</p>
</li>
</ol>
<p>When the Monitoring dashboard opens, your workspace is ready.</p>
<p><img alt="monitoring_overview.png" src="https://cdn.qwiklabs.com/LJwBqdRLAHCGvak2aWAYfwTO94fPnvGxlW%2Fk6KRVOHM%3D"></p>

<h3>Configure an uptime check</h3>
<p>The Cloud Monitoring window opens.</p>
<ol>
<li>In the Cloud Monitoring tab, click on <strong>Uptime Checks</strong>
</li>
<li>Click <strong>Create Uptime Check</strong>.</li>
<li>In the <strong>New uptime check</strong> page Specify the following:</li>
</ol>
<table>

<tr>
<th>Property</th>
<th>Value</th>
</tr>


<tr>
<td>Title</td>
<td>Check1</td>
</tr>
<tr>
<td>Check Type</td>
<td>TCP</td>
</tr>
<tr>
<td>Resource Type</td>
<td>URL</td>
</tr>
<tr>
<td>Hostname</td>
<td>
<code>&lt;your forwarding address&gt;</code> (you previously recorded)</td>
</tr>
<tr>
<td>Port</td>
<td>8080</td>
</tr>
<tr>
<td>Response content contains the text</td>
<td><code>&lt;leave blank&gt;</code></td>
</tr>
<tr>
<td>Check every</td>
<td>1 minute</td>
</tr>

</table>
<ol start="4">
<li>Click <strong>Test</strong> to test the check:</li>
</ol>
<p><img alt="7f60fe39e946f680.png" src="https://cdn.qwiklabs.com/eay9YeJ5k9vIdLIv62KrdE3aOgp3kCbtwGZE3zwAnZI%3D"></p>
<aside class="special"><p>If the test fails, make sure that the service is still working. Also check to see that the firewall rule exists and is correct.</p>
</aside>
<ol start="5">
<li>After the test succeeds, click <strong>Save</strong>.</li>
</ol>
<p>After the Uptime Check is saved, Cloud Monitoring offers to create an alerting policy. Click <strong>No, Thanks</strong>.</p>
<p><img alt="bfe4607c7305436d.png" src="https://cdn.qwiklabs.com/5P8EvAIM64KkuQrUlbLCndLuh85pVz%2BUrIX6MpBRhT0%3D"></p>
<h2 id="step12">Configure an alerting policy and notification</h2>
<ol>
<li>
<p>Click on <strong>Alerting</strong> &gt; <strong>Create Policy</strong>.</p>
</li>
<li>
<p>Name the policy <strong>Test</strong>.</p>
</li>
<li>
<p>Click <strong>Add Condition</strong>.</p>
</li>
<li>
<p>For <strong>Find resource type and metric</strong>, select <strong>GCE VM Instance</strong>.</p>
</li>
<li>
<p>For <strong>Metrics</strong>, select a metric you are interested in evaluating, such as <strong>CPU usage</strong> or <strong>CPU utilization</strong>.</p>
</li>
<li>
<p>For <strong>Condition</strong>, select <strong>is above</strong>.</p>
</li>
<li>
<p>Specify the threshold value and for how long the metric must cross this set value before the alert is triggered. For example, for <strong>THRESHOLD</strong>, type <strong>20</strong> and set <strong>FOR</strong> to <strong>1 minute</strong>.</p>
</li>
<li>
<p>Click <strong>Add</strong>.</p>
</li>
<li>
<p>In <strong>Notifications</strong>, click on <strong>Add Notification Channel</strong> select Notification Channel type as "Email" and add your personal email. Then Click <strong>Add</strong>.</p>
<p>In a later step, you trigger an event that notify you via email.</p>
</li>
<li>
<p>Click <strong>Save</strong>.</p>
</li>
</ol>
<p>Click <strong>Check my progress</strong> below to check your lab progress.</p>
<ql-activity-tracking step="2">
    Configure an Uptime Check and Alert Policy in Cloud Monitoring
</ql-activity-tracking>
<h2 id="step13">Configure a Dashboard with a Couple of Useful Charts</h2>
<h3>Configure a dashboard</h3>
<ol>
<li>
<p>In the left menu, click <strong>Dashboards</strong> &gt; <strong>Create Dashboard</strong></p>
</li>
<li>
<p>Name the New Dashboard  <strong>DMDash</strong>. and then Click <strong>Confirm</strong>.</p>
</li>
<li>
<p>Click <strong>Add Chart</strong> in the top right.</p>
<p><img alt="ef98bfe7497869ed.png" src="https://cdn.qwiklabs.com/7mqY6WhK4LAtBMDffF1udM%2FkvqUHeJJPO1IL1dV3iok%3D"></p>
</li>
<li>
<p>Set the following properties:</p>
</li>
</ol>
<table>

<tr>
<th>Property</th>
<th>Value</th>
</tr>


<tr>
<td>Title</td>
<td>Sample</td>
</tr>
<tr>
<td>Resource type</td>
<td>GCE VM Instance</td>
</tr>
<tr>
<td>Metric Type</td>
<td>CPU Usage</td>
</tr>

</table>
<ol start="5">
<li>Click  <strong>Save</strong>.</li>
<li>Click on <strong>Add Chart</strong> to add another chart to the dashboard with the following properties:</li>
</ol>
<table>

<tr>
<th>Property</th>
<th>Value</th>
</tr>


<tr>
<td>Title</td>
<td>Sample 2</td>
</tr>
<tr>
<td>Resource type</td>
<td>GCE VM Instance</td>
</tr>
<tr>
<td>Metric Type</td>
<td>Sent bytes</td>
</tr>

</table>
<ol start="7">
<li>
<p>Click  <strong>Save</strong> DMDash should look like this:</p>
<p><img alt="8b18deae69fb8132.png" src="https://cdn.qwiklabs.com/NO8Ga0SKlB8dId7XxLbrRrVrA3DDYObh8xGsfoPPdOM%3D"></p>
</li>
</ol>
<h2 id="step14">Create a test VM with ApacheBench</h2>
<p>Now that you've configured monitoring for traffic in a specified region, see if it works. You'll install and use ApacheBench to apply 3 levels of load to the service and then view the Cloud Monitoring Dashboard you've set up.</p>
<h3>Create a VM</h3>
<ol>
<li>
<p>In the Cloud Console, click <strong>Compute Engine</strong> &gt; <strong>VM instances</strong>.</p>
<p><img alt="cf68a77143674661.png" src="https://cdn.qwiklabs.com/vbSlqad%2BVrl178fWsGAaH%2BmPyCI%2Fdjo0hGtwvn793mg%3D"></p>
</li>
<li>
<p>Click <strong>Create instance</strong>, use all the default settings in the <strong>Create an instance</strong> dialog.</p>
<p><img alt="Create_Instance.png" src="https://cdn.qwiklabs.com/J%2BpSMLd%2FmiylLCHiefiff22NU0a9k1S1SuI8Du16%2F50%3D"></p>
</li>
<li>
<p>Click <strong>Create</strong>.</p>
</li>
</ol>
<h3>Install ApacheBench</h3>
<ol>
<li>
<p>Still in the VM Instances window, click the instance-1 <strong>SSH</strong> button to SSH into the VM you just created.</p>
</li>
<li>
<p>Enter the following commands to install the latest ApacheBench:</p>
</li>
</ol>
<pre><code>sudo apt-get update&#x000A;</code></pre>
<pre><code>sudo apt-get -y install apache2-utils&#x000A;</code></pre>
<p>Click <strong>Check my progress</strong> below to check your lab progress.</p>
<ql-activity-tracking step="3">
    Create a Test VM with ApacheBench.
</ql-activity-tracking>
<h3>Apply and monitor load</h3>
<p>Now you'll use ApacheBench to apply load to the service. Watch the DMDash dashboard in Cloud Monitoring to monitor the CPU usage and the Network Inbound Traffic. You'll also be able to track the number of instances in Cloud Monitoring by mousing over the lines, or by viewing the instances in the Cloud Console (<strong>Navigation menu</strong> &gt; <strong>Compute Engine</strong> &gt; <strong>VM</strong>).</p>
<ol>
<li>
<p>In the SSH window, enter this command for ApacheBench to apply load to the service. Replace your forwarding IP for <code>Your_IP</code> (you previously recorded). Run the following command two or three times to create traffic.</p>
</li>
</ol>
<pre><code>ab -n 1000 -c 100 http://&lt;Your_IP&gt;:8080/&#x000A;</code></pre>
<p><strong>Sample output:</strong></p>
<pre><code>This is ApacheBench, Version 2.3 &lt;$Revision: 1757674 $&gt;&#x000A;Copyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/&#x000A;Licensed to The Apache Software Foundation, http://www.apache.org/&#x000A;&#x000A;Benchmarking 35.196.195.26 (be patient)&#x000A;Completed 100 requests&#x000A;Completed 200 requests&#x000A;Completed 300 requests&#x000A;Completed 400 requests&#x000A;Completed 500 requests&#x000A;Completed 600 requests&#x000A;Completed 700 requests&#x000A;Completed 800 requests&#x000A;Completed 900 requests&#x000A;Completed 1000 requests&#x000A;Finished 1000 requests&#x000A;&#x000A;Server Software:&#x000A;Server Hostname:        35.196.195.26&#x000A;Server Port:            8080&#x000A;&#x000A;Document Path:          /&#x000A;Document Length:        40 bytes&#x000A;&#x000A;Concurrency Level:      100&#x000A;Time taken for tests:   0.824 seconds&#x000A;Complete requests:      1000&#x000A;Failed requests:        0&#x000A;Total transferred:      140000 bytes&#x000A;HTML transferred:       40000 bytes&#x000A;Requests per second:    1213.57 [#/sec] (mean)&#x000A;Time per request:       82.402 [ms] (mean)&#x000A;Time per request:       0.824 [ms] (mean, across all concurrent requests)&#x000A;Transfer rate:          165.92 [Kbytes/sec] received&#x000A;&#x000A;Connection Times (ms)&#x000A;              min  mean[+/-sd] median   max&#x000A;Connect:       36   37   0.5     37      40&#x000A;Processing:    36   43   8.7     38      73&#x000A;Waiting:       36   43   8.7     38      73&#x000A;Total:         73   80   9.1     75     112&#x000A;&#x000A;Percentage of the requests served within a certain time (ms)&#x000A;  50%     75&#x000A;  66%     78&#x000A;  75%     81&#x000A;  80%     84&#x000A;  90%     95&#x000A;  95%    101&#x000A;  98%    106&#x000A;  99%    110&#x000A; 100%    112 (longest request)&#x000A;</code></pre>
<p>Wait a few minutes, then increase the load to 5000.</p>
<ol start="2">
<li>
<p>Run this command two or three times to create traffic:</p>
</li>
</ol>
<pre><code>ab -n 5000 -c 100 http://&lt;Your_IP&gt;:8080/&#x000A;</code></pre>
<p>Wait a few minutes, then increase the load to 10000.</p>
<ol start="3">
<li>
<p>Run this command two or three times to create traffic:</p>
</li>
</ol>
<pre><code>ab -n 10000 -c 100 http://&lt;Your_IP&gt;:8080/&#x000A;</code></pre>
<p>Now see what happens when you lower the CPU usage per instance.</p>
<ol>
<li>In the cloud console, click <strong>Navigation menu</strong> &gt; <strong>Compute Engine</strong> &gt; <strong>Instance groups</strong>.</li>
<li>Click on the name of your instance group, click on the Details tab, and then click <strong>Edit Group</strong>.</li>
<li>Change the CPU utilization. Click <strong>CPU utilization</strong>, change <strong>Target CPU utilization</strong> to <strong>20</strong>, and then click <strong>Done</strong>.</li>
<li>Click <strong>Save</strong>.</li>
</ol>
<aside class="special"><p>The target CPU usage is the total value of the CPU usage for all VMs in the instance group. This controls when autoscaling occurs. In production you would usually have this set to at least 60%. For this exercise you set it temporarily to 20% to make it quicker to examine autoscaling.</p>
</aside>
<p>Run this command two or three times to create traffic:</p>
<pre><code>ab -n 10000 -c 100 http://&lt;Your_IP&gt;:8080/&#x000A;</code></pre>
<p><strong>Expected behavior:</strong> The load consumed more than 20% of the cumulative CPU in the group, triggering autoscaling. A new instance was started.</p>
<p>Now see what happens when you turn autoscaling off.</p>
<ol>
<li>Go to <strong>Compute Engine</strong> &gt; <strong>Instance groups</strong>.</li>
<li>Click the name of your instance group, then <strong>Edit Group</strong>.</li>
<li>Change <strong>Autoscaling mode</strong> to <strong>Don't autoscale</strong>.</li>
<li>Click <strong>Save</strong>.</li>
</ol>
<p>Wait a few minutes, then run this command two or three times to create traffic:</p>
<pre><code>ab -n 10000 -c 100 http://&lt;Your_IP&gt;:8080/&#x000A;</code></pre>
<p><strong>Expected behavior:</strong> With autoscaling off, no new instances are created, cumulative CPU usage increases.</p>
<h3>Results</h3>
<p>There is a lag time of around 5 minutes before you see changes in the Cloud Monitoring Dashboard.</p>
<h2 id="step15">Simulate a Service Outage</h2>
<p>To simulate an outage, remove the firewall.</p>
<ol>
<li>
<p>Click <strong>Navigation menu</strong> &gt; <strong>VPC Networks</strong> &gt; <strong>Firewall rules</strong>.</p>
</li>
<li>
<p>Check the box next to the firewall rule which contains <strong>tcp:8080</strong>, then click <strong>Delete</strong> at the top of the page. Click <strong>Delete</strong> again to confirm.</p>
</li>
<li>
<p>You will receive a notification email in 15 to 30 minutes.</p>
</li>
</ol>
<h2 id="step16">Test your knowledge</h2>
<p>Test your knowledge about Google cloud Platform by taking our quiz.</p>
<p><ql-true-false-probe answer="true" stem="Cloud Monitoring collects metrics, events, and metadata from Google Cloud Platform, Amazon Web Services, hosted uptime probes, application instrumentation, and a variety of common application components including Cassandra, Nginx, Apache Web Server, Elasticsearch, and many others. ">
</ql-true-false-probe></p>
<h2 id="step17">Congratulations!</h2>
<p><img alt="c19694752c475f16.png" src="https://cdn.qwiklabs.com/Dr5EtfhvT7F7Asg6VvWZwpwPe4cgxXVkXN7%2BEmmumqI%3D">
<img alt="Cloud_Architecture.png" src="https://cdn.qwiklabs.com/QNBqfg1D%2FzCw3KdiioKbnB1YWX9jpAs21holGhwny%2FY%3D">
<img alt="CloudEngineeringExaPrep_125.pmg" src="https://cdn.qwiklabs.com/jVIZEu1uWCkufNtCmqyElRifK5o%2FNRrtt5Vo9iZxHz8%3D"></p>
<h2 id="step18">Finish your Quest</h2>
<p>This self-paced lab is part of the  <a href="https://google.qwiklabs.com/quests/30">Deployment Manager</a>, <a href="https://google.qwiklabs.com/quests/24">Cloud Architecture</a>, and <a href="https://google.qwiklabs.com/quests/66">Cloud Engineering</a> Quests. A Quest is a series of related labs that form a learning path. Completing this Quest earns you the badge above, to recognize your achievement. You can make your badge public and link to them in your online resume or social media account.  Enroll in a Quest and get immediate completion credit if you've taken this lab.  <a href="https://google.qwiklabs.com/catalog">See other available Qwiklabs Quests</a>.</p>
<h3>Take your next lab</h3>
<p>Continue your Quest with  <a href="https://google.qwiklabs.com/catalog_lab/1148">Create a Custom Network Using Deployment Manager</a>, or check out these suggestions:</p>
<ul>
<li>
<p><a href="https://google.qwiklabs.com/catalog_lab/1149">Create a Network Load-Balanced Logbook Application</a></p>
</li>
<li>
<p><a href="https://qwiklabs.com/catalog_lab/1121">Deployment Manager for Appserver</a></p>
</li>
</ul>
<h3>Next steps / learn more</h3>
<ul>
<li>Check out how Cloud Monitoring can be used, see <a href="https://cloud.google.com/stackdriver/docs/">Cloud Monitoring Documentation</a>.</li>
<li>Learn more about Deployment Manager, see  <a href="https://cloud.google.com/deployment-manager/docs/fundamentals">Deployment Manager Fundamentals</a>.</li>
<li>How about our tutorials? There are  <a href="https://cloud.google.com/deployment-manager/docs/tutorials">several step-by-step tutorials</a> in the documentation. This lab is based on one of those tutorials, but includes additional content. The Deployment Manager template used in this lab generates an advanced HTTP(S) Load Balanced deployment for a Logbook sample application.  <a href="https://cloud.google.com/deployment-manager/docs/create-advanced-http-load-balanced-deployment">Sample templates</a> are available in both Jinja and Python. This lab used the Python version.</li>
</ul>
<h3>Google Cloud Training &amp; Certification</h3>
<p>...helps you make the most of Google Cloud technologies. <a href="https://cloud.google.com/training/courses" target="_blank">Our classes</a> include technical skills and best practices to help you get up to speed quickly and continue your learning journey. We offer fundamental to advanced level training, with on-demand, live, and virtual options to suit your busy schedule. <a href="https://cloud.google.com/certification/" target="_blank">Certifications</a> help you validate and prove your skill and expertise in Google Cloud technologies.</p>

<h5>Manual last updated April 29, 2020</h5>
<h5>Lab last tested March 11, 2020</h5>
<p>Copyright 2020 Google LLC All rights reserved. Google and the Google logo are trademarks of Google LLC. All other company and product names may be trademarks of the respective companies with which they are associated.</p>



</div>
<div class='js-lab-content-outline lab-content__outline'>
<a href='#step1'>GSP060</a><a href='#step2'>Overview</a><a href='#step3'>Objectives</a><a href='#step4'>Setup and Requirements</a><a href='#step5'>Create a virtual environment</a><a href='#step6'>Clone the Deployment Manager Sample Templates</a><a href='#step7'>Explore the Sample Files</a><a href='#step8'>Customize the Deployment</a><a href='#step9'>Run the Application</a><a href='#step10'>Verify that the application is operational</a><a href='#step11'>Configure an uptime check and alert policy in Cloud Monitoring</a><a href='#step12'>Configure an alerting policy and notification</a><a href='#step13'>Configure a Dashboard with a Couple of Useful Charts</a><a href='#step14'>Create a test VM with ApacheBench</a><a href='#step15'>Simulate a Service Outage</a><a href='#step16'>Test your knowledge</a><a href='#step17'>Congratulations!</a><a href='#step18'>Finish your Quest</a>
</div>
</div>

</div>

<div class='lab-content__markdown-wrapper'>
<div class='lab-content__markdown'>
<div class='lab-content__recommendation'>
<!-- # TODO: Change classes so that this doesn't stack vertically -->
<section class='upcoming-cards'>
<h2 class='headline-3'>Continue questing</h2>
<div class='content-card-grid'>
<div class='card-content-wrapper js-content-card' data-id='1583' data-level='Advanced' data-name='Site Reliability Troubleshooting with Cloud Monitoring APM' data-type='Lab'>
<a class="card card--content elevation-0 content-lab" href="/focuses/4186?parent=catalog"><div class='card__image'>
<div class='card__image__inner' style='background-image: url(https://cdn.qwiklabs.com/assets/fractal1-90735da7b9906552121e230998c46ac7e2e5f943f2c909a6da76f50d7e815976.jpg)'></div>
</div>
<div class='card__body'>
<div class='overline card--content__type'>
Hands-On Lab
</div>
<h3 class='card--content__title'>
Site Reliability Troubleshooting with Cloud Monitoring APM
</h3>
<p class='card--content__description body-1'>
The objective of this lab is to familiarize yourself with the specific capabilities of Cloud Monitoring to monitor GKE cluster infrastructure, Istio, and applications deployed on this infrastructure.
</p>
</div>
<div class='card__footer'>
<div class='card__footer__left'>
<span>Advanced</span>
</div>
<div class='card__footer__right'>
<div class='rateit' data-rateit-readonly='true' data-rateit-value='3.9271'></div>
</div>
</div>
</a></div>

</div>
</section>

</div>
</div>
</div>

</div>
</div>
<div class='lab-assessment__tab js-lab-assessment-tab'>
<h5 class='small-label'>
Score
</h5>
<h3 class='js-lab-assessment-total-score'>
&mdash;/100
</h3>
<iframe class='l-ie-iframe-fix'></iframe>
</div>
<div class='lab-assessment__panel js-lab-assessment-panel'>
<!-- / If lab_instance has is started and assessment is generated, use -->
<!-- / lab_instance.assessment, otherwise use lab.assessment_manual -->
<div class='lab-assessment__step'>
<p class='lab-assessment__step__title'>
Deploy the application
</p>
<p class='button button--assessment js-show-run-step-button' step_no='1'>
Run Step
</p>
<p class='lab-assessment__step__score'>
<span class='js-assessment-step-score-1'>
</span>
/ 50
</p>
</div>

<div class='lab-assessment__step'>
<p class='lab-assessment__step__title'>
Configure an uptime check and alert policy in Cloud Monitoring
</p>
<p class='button button--assessment js-show-run-step-button' step_no='2'>
Run Step
</p>
<p class='lab-assessment__step__score'>
<span class='js-assessment-step-score-2'>
</span>
/ 25
</p>
</div>

<div class='lab-assessment__step'>
<p class='lab-assessment__step__title'>
Create a test VM with ApacheBench
</p>
<p class='button button--assessment js-show-run-step-button' step_no='3'>
Run Step
</p>
<p class='lab-assessment__step__score'>
<span class='js-assessment-step-score-3'>
</span>
/ 25
</p>
</div>

<iframe class='l-ie-iframe-fix'></iframe>
</div>
<div class='lab-introduction js-lab-introduction is-hidden'>
<div class='lab-introduction__inner'>
<h1 class='headline-1'>Welcome to Your First Lab!</h1>
<ql-icon-button class='js-skip-button'>close</ql-icon-button>
<div class='lab-introduction__video'>
<iframe allow='autoplay; encrypted-media' allowfullscreen frameborder='0' id='lab-introduction' src='https://www.youtube.com/embed/yF7EDXKTmoQ?enablejsapi=1&amp;rel=0&amp;showinfo=0'></iframe>
</div>
<a class='js-skip-button button button--outline'>Skip this video</a>
</div>
</div>



</div>
</main>
<div class='modal fade' id='lab-details-modal'>
<div class='modal-container'>
<div class='mdl-shadow--24dp modal-content'>
<div class='modal-body'>
<p class='l-mbm'>
In this lab you will launch a service using Deployment Manager, and monitor it using Cloud Monitoring. You will set up basic black box monitoring with Cloud Monitoring Dashboard and establish uptime check alert notification to trigger incident response.
</p>
<p>
This lab is included in these quests:
<a href="/quests/24">Cloud Architecture</a>, <a href="/quests/66">Cloud Engineering</a>, <a href="/quests/30">Deployment Manager</a>.
If you complete this lab you&#39;ll receive credit for it when you enroll in one of these quests.
</p>
<p class='small-label l-mbs'>
<strong>
Duration:
</strong>
0m setup
&middot;
90m access
&middot;
90m completion
</p>
<p class='small-label l-mbs'>
<span><strong>Levels: </strong>expert</span>
</p>
<p class='small-label'>
<strong>
Permalink:
</strong>
<a href="https://www.qwiklabs.com/catalog_lab/940">https://www.qwiklabs.com/catalog_lab/940</a>
</p>
</div>
<div class='modal-actions'>
<a class='mdl-button mdl-button--primary mdl-js-button mdl-js-ripple-effect' data-dismiss='modal'>
Got It
</a>
</div>


</div>
</div>
<iframe class='l-ie-iframe-fix'></iframe>
</div>
<div class='modal fade' id='lab-review-modal'>
<div class='modal-container'>
<div class='mdl-shadow--24dp modal-content'>
<form class="simple_form js-lab-review-form" id="edit_lab_review_5374303" action="/lab_reviews/5374303" accept-charset="UTF-8" data-remote="true" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><input type="hidden" name="_method" value="patch" /><div class='modal-body'>
<p class='label'>
How satisfied are you with this lab?*
</p>
<div class='rateit js-rateit' data-rateit-max='5' data-rateit-min='0' data-rateit-resetable='false' data-rateit-step='1' data-rateit-value='5'></div>
<div class='l-mtm'>

<div class="control-group hidden lab_review_user_id"><div class="controls"><input class="hidden" type="hidden" value="2485272" name="lab_review[user_id]" id="lab_review_user_id" /></div></div>
<div class="control-group hidden lab_review_classroom_id"><div class="controls"><input class="hidden" type="hidden" name="lab_review[classroom_id]" id="lab_review_classroom_id" /></div></div>
<div class="control-group hidden lab_review_lab_id"><div class="controls"><input class="hidden" type="hidden" value="940" name="lab_review[lab_id]" id="lab_review_lab_id" /></div></div>
<div class="control-group hidden lab_review_focus_id"><div class="controls"><input class="hidden" type="hidden" name="lab_review[focus_id]" id="lab_review_focus_id" /></div></div>
<div class="control-group hidden lab_review_rating"><div class="controls"><input class="hidden js-rating-input" type="hidden" value="2" name="lab_review[rating]" id="lab_review_rating" /></div></div>
<div class="control-group text optional lab_review_comment"><label class="text optional control-label" for="lab_review_comment">Comment</label><div class="controls"><textarea class="text optional" name="lab_review[comment]" id="lab_review_comment">
</textarea></div></div>
</div>
</div>
<div class='modal-actions'>
<a class='mdl-button mdl-button--primary mdl-js-button mdl-js-ripple-effect' data-dismiss='modal'>
Cancel
</a>
<input type="submit" name="commit" value="Submit" disabled="disabled" class="btn mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--primary" id="submit" data-disabled="false" data-disable-with="Submit" />
</div>
</form>

</div>
</div>
<iframe class='l-ie-iframe-fix'></iframe>
</div>
<div class='modal fade' id='lab-access-modal'>
<div class='modal-container'>
<div class='mdl-shadow--24dp modal-content'>
<a class='lab-access-modal-close' data-analytics-action='dismissed_lab_payment_modal' data-dismiss='modal'>
<i class='material-icons'>close</i>
</a>
<form class="js-lab-access-form" action="/lab_onetime_coupons/activate?parent=catalog" accept-charset="UTF-8" data-remote="true" method="post"><input name="utf8" type="hidden" value="&#x2713;" />
<div class='modal-body'>
<div class='lab-access-modal'>
<input type="hidden" name="id" id="id" value="981" />
<input type="hidden" name="user_id" id="user_id" value="2485272" />
<input type="hidden" name="launch_with_credits" id="launch_with_credits" value="0" class="js-launch-with-credits-input" />
<input type="hidden" name="launch_with_subs" id="launch_with_subs" value="0" class="js-launch-with-subscription-input" />
<div class='lab-access-modal__method'>
<p>
This lab costs
9 Credits.
</p>
<p>
You have a valid subscription package. Would you like to charge this lab to your subscription?

</p>
<a class='button js-launch-with-subscription-button js-lab-access-modal-button' data-analytics-action='clicked_launch_with_subscription_button'>
Use Subscription
</a>
</div>
<div class='lab-access-modal__method'>
<p>
Enter Lab Access Code:
</p>
<div class='lab-access-modal__code js-access-code'>
<input type="text" name="uuid_1" id="uuid_1" value="" maxlength="4" placeholder="1234" />
<input type="text" name="uuid_2" id="uuid_2" value="" maxlength="4" placeholder="1234" />
<input type="text" name="uuid_3" id="uuid_3" value="" maxlength="4" placeholder="1234" />
<input type="text" name="uuid_4" id="uuid_4" value="" maxlength="4" placeholder="1234" />
</div>
<a class='button js-launch-with-access-code-button js-lab-access-modal-button' data-analytics-action='clicked_launch_with_access_code_button'>
Launch with Access Code
</a>
</div>
</div>
</div>
</form>



</div>
</div>
<iframe class='l-ie-iframe-fix'></iframe>
</div>

<script>
  $( function() {
    ql.initMaterialInputs();
    initChosen();
    initSearch();
    initTabs();
    ql.list.init();
    ql.favoriting.init();
    ql.header.myAccount.init();
    initTooltips();
    ql.autocomplete.init();
    ql.modals.init();
    ql.toggleButtons.init();
    ql.analytics.init();
    initLabContent( );
  ql.labOutline.links.init();
  ql.labOutline.layout.init();
  initLabReviewModal();
  initLabAccessModal();
  ql.labAssessment.init();
  ql.labIntroduction.init( true );
  ql.labData.init();
  initLabTranslations( {"are_you_sure":"All done? If you end this lab, you will lose all your work. You may not be able to restart the lab if there is a quota limit. Are you sure you want to end this lab?\n","in_progress":"*In Progress*","ending":"*Ending*","starting":"*Starting, please wait*","end_concurrent_labs":"Sorry, you can only run one lab at a time. To start this lab, please confirm that you want all of your existing labs to end.\n","copied":"Copied","no_resource":"Error retrieving resource.","no_support":"No Support","mac_press":"Press ‚åò-C to copy","thanks_review":"Thanks for reviewing this lab.","windows_press":"Press Ctrl-C to copy","days":"days"} );
  ql.labRun.init();
  ql.initHeader();
  ql.navigation.init();
  ql.navPanel.init();
  ql.navigation.init();
  
  });
</script>
<style>
  .mdl-layout__container {
    position: static
  }
</style>
</body>
</html>
