<!DOCTYPE html>
<html lang='en'>
<head>
<meta content='[]' name='active-experiments'>
<meta content='{&quot;userId&quot;:2485272}' name='help-api-product-data'>
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="UEHM3v7ktJwej3XzvK3dSjEqoH+z5K4xtSkYRpqEPUWkdCw9PSF9NSoxiY+TCfwrppXr++oCJ+leacWFpmwkHQ==" />
<title>Continuous Delivery Pipelines with Spinnaker and Kubernetes Engine | Qwiklabs</title>
<meta content='width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=0' name='viewport'>
<meta content='Create a Kubernetes Engine cluster, deploy an application, and use Spinnaker to continuously deploy the application when changes are made to the application.' name='description'>
<meta content='Qwiklabs' name='author'>
<meta content='1rRsY0INj8RvwB5EF5pwdxt2A2P9aDgAlsICaJ0d5w0' name='google-site-verification'>
<meta content='Continuous Delivery Pipelines with Spinnaker and Kubernetes Engine | Qwiklabs' property='og:title'>
<meta content='website' property='og:type'>
<meta content='/favicon-144.png' property='og:image'>
<meta content='Qwiklabs' property='og:site_name'>
<meta content='Create a Kubernetes Engine cluster, deploy an application, and use Spinnaker to continuously deploy the application when changes are made to the application.' property='og:description'>
<meta content='/qwiklabs_logo_900x887.png' property='og:logo' size='900x887'>
<meta content='/qwiklabs_logo_994x187.png' property='og:logo' size='994x187'>
<meta content='#3681E4' property='msapplication-TileColor'>
<meta content='/favicon-144.png' property='msapplication-TileImage'>
<link href='/favicon-32.png' rel='shortcut icon'>
<link color='#3681E4' href='/favicon-svg.svg' rel='mask-icon'>
<link href='/favicon-180.png' rel='apple-touch-icon-precomposed'>
<link rel="stylesheet" media="screen" href="https://fonts.googleapis.com/css?family=Oswald:400|Roboto+Mono:400,700|Roboto:300,400,500,700|Google+Sans:300,400,500,700|Google+Sans+Display:400|Material+Icons|Google+Material+Icons" />


<!--[if lt IE 9]>
<script src='http://html5shim.googlecode.com/svn/trunk/html5.js' type='text/javascript'></script>
<![endif]-->
<!--[endif]>  <![endif]-->
<script>
//<![CDATA[
window.gon={};gon.current_user={"firstname":"Carlo Andr\u00e9","lastname":"Castro Galindo","fullname":"Carlo Andr\u00e9 Castro Galindo","company":"Coursera","email":"carlocastrogalindo@gmail.com","origin":"googlecoursera-run, lti-coursera","subscriptions":1,"id":"eb3f0602d940d94d2eaeef36f2aa2e77","qlCreatedAt":"2020-02-28 17:36:48 UTC","optIn":false};gon.segment="j4Im8pqIko0Lxq4wVVZWMPMM0EroHUvb";gon.deployment="run";
//]]>
</script>
<script type='application/ld+json'>
{
  "@context": "http://schema.org",
  "@type": "WebSite",
  "url": "https://www.qwiklabs.com/",
  "potentialAction": {
    "@type": "SearchAction",
    "target": "https://www.qwiklabs.com/catalog?keywords={search_term_string}",
    "query-input": "required name=search_term_string"
  }
}
</script>
<script id='ze-snippet' src='https://static.zdassets.com/ekr/snippet.js?key=511e4158-0aec-4e3c-b2e6-4daa1769f51e'></script>



<link rel="stylesheet" media="all" href="https://cdn.qwiklabs.com/assets/application-24120c1aef38a3b99b2e86e178f8f60bb0e27812dc7adfea7b9339d8f1fd09b0.css" />
<script>
  EVENT_SOURCE_BASE_URL = "https://run.qwiklabs.com/nchan-sub?id=";
</script>
<script src="https://cdn.qwiklabs.com/polyfills/webcomponents-loader.js"></script>
<script src="https://cdn.qwiklabs.com/assets/hallofmirrors/hallofmirrors-f85649837b49ca7f1e74eb3f73279677cceab3c00277677d234942f2a30157a1.js"></script>
<script src="https://www.youtube.com/iframe_api"></script>
<script src="https://cdn.qwiklabs.com/assets/vendor-45d462772c30000424907184f70c7157e95fb6227698d1671c5051818a6f60d8.js"></script>
<script src="https://cdn.qwiklabs.com/assets/application-7c67c1d428839917a0992758b33da63184c69efa420e5939804ea34d54147a97.js"></script>
</head>
<body class='focuses focuses-show lab-show l-full no-nav'>
<div class='header-container light-theme'>
<div class='header'>
<a class='mdl-button mdl-button--icon mdl-js-button mdl-js-ripple-effect header__button header__button--nav header__nav-panel-button js-nav-toggle'>
<i class='material-icons'>menu</i>
</a>
<div class='header__title'>
<a class="mdl-button mdl-js-button mdl-button--icon mdl-js-ripple-effect header__button header__button--nav" href="https://www.qwiklabs.com/quests/24"><ql-icon>arrow_back</ql-icon></a>

<h1 class='headline-5'>
Continuous Delivery Pipelines with Spinnaker and Kubernetes Engine
</h1>
</div>
<div class='header__actions'>
<a class='mdl-button mdl-js-button mdl-button--icon mdl-js-ripple-effect header__button header__button--action header__button--search js-header-search-bar-button'>
<i class='material-icons'>search</i>
</a>
<a class="mdl-button mdl-button--icon mdl-js-button mdl-js-ripple-effect" id="toggle-lab-control-panel" href="javascript:;"><i class='material-icons'>description</i>
</a><div class='mdl-tooltip js-tooltip' data-mdl-for='toggle-lab-control-panel'>
Toggle Lab Panel
</div>
<a class="mdl-button mdl-button--icon mdl-js-button mdl-js-ripple-effect js-favorite-button favorite-button" id="CatalogItem-552-favorite-button" data-type="CatalogItem" data-id="552" data-name="Continuous Delivery Pipelines with Spinnaker and Kubernetes Engine" href="/favorite.json?item_id=552&amp;item_type=CatalogItem"><i class='material-icons'>favorite_border</i>
</a><div class='mdl-tooltip js-tooltip' for='CatalogItem-552-favorite-button'>
Add to favorites
</div>


<ql-help context="lab" productdata="{&quot;userId&quot;:2485272}" data-analytics-action="opened_help" data-analytics-label="lab"></ql-help>
<a class='header-my-account-button mdl-button mdl-button--icon mdl-js-button mdl-js-ripple-effect js-my-account-button'>
<img class="avatar " alt="avatar image" src="https://secure.gravatar.com/avatar/be719396bbcc1e8bcb204a54e1920c54.png?s=80&amp;d=mm" />
</a>
<div class='header-my-account-menu js-my-account-menu'>
<div class='card elevation-2 no-padding'>
<div class='my-account-menu__top'>
<img class="avatar " alt="avatar image" src="https://secure.gravatar.com/avatar/be719396bbcc1e8bcb204a54e1920c54.png?s=80&amp;d=mm" />
<div class='my-account-menu__info'>
<h4 class='subtitle-headline-1'>
Carlo Andr√© Castro Galindo
</h4>
<p class='body-2 text--gray'>
<span>carlocastrogalindo@gmail.com</span>
</p>
<a class="button" href="/my_account/profile">My Account</a>
</div>
</div>
<div class='my-account-menu__bottom'>
<a class="text--green subtitle-headline-2" href="/my_account/credits">Monthly Subscription
</a><a data-analytics-action="clicked_sign_out" class="button button--hairline" rel="nofollow" data-method="delete" href="/users/sign_out">Sign Out</a>
</div>
</div>
</div>

</div>
</div>
<div class='header__search-bar js-header-search-bar'>
<form id="catalog-search-mobile" onsubmit="ql.catalogSearchFilter(); return false;" action="/searches/elasticsearch" accept-charset="UTF-8" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><input type="hidden" name="authenticity_token" value="N5wM6gyjeV53BLghh0YzgxpucLKPrX9sxkAU+T4XHEjDqewJz2aw90O6RF2o4hLijdE7NtZL9rQtAMk6Av8FEA==" />
<input type="text" name="keywords" id="keywords" placeholder="Search" maxlength="255" aria-label="catalog search bar" />
</form>

<a class='mdl-button mdl-js-button mdl-button--icon mdl-js-ripple-effect header__button'>
<i class='material-icons'>close</i>
</a>
</div>
</div>

<nav class='nav-bar'>
<a class="nav-bar__item js-navigation-button" href="/"><ql-icon class='nav-bar__item__icon'>
home
</ql-icon>
<span class='nav-bar__item__label'>
Home
</span>
</a>
<a class="nav-bar__item js-navigation-button  active" aria-current="page" href="/catalog"><ql-icon class='nav-bar__item__icon'>
school
</ql-icon>
<span class='nav-bar__item__label'>
Catalog
</span>
</a>
<a class="nav-bar__item js-navigation-button" href="/my_learning"><ql-icon class='nav-bar__item__icon'>
event_note
</ql-icon>
<span class='nav-bar__item__label'>
My Learning
</span>
</a>
</nav>

<nav class='nav-panel js-nav-panel'>
<div class='nav-panel__logo'>
<div class='logo logo--blue'></div>
</div>
<a title="Home" tabindex="-1" class="nav-panel__item js-navigation-button" href="/"><ql-icon class='nav-panel__item__icon'>
home
</ql-icon>
<div class='nav-panel__item__label'>
Home
</div>
</a>
<a title="Catalog" tabindex="-1" class="nav-panel__item js-navigation-button active" aria-current="page" href="/catalog"><ql-icon class='nav-panel__item__icon'>
school
</ql-icon>
<div class='nav-panel__item__label'>
Catalog
</div>
</a>
<a title="My Learning" tabindex="-1" class="nav-panel__item js-navigation-button" href="/my_learning"><ql-icon class='nav-panel__item__icon'>
event_note
</ql-icon>
<div class='nav-panel__item__label'>
My Learning
</div>
</a>
<div class='nav-panel__spacer'></div>
<a title="Profile" tabindex="-1" class="nav-panel__item js-navigation-button" href="/my_account/profile"><ql-icon class='nav-panel__item__icon'>
account_circle
</ql-icon>
<div class='nav-panel__item__label'>
Profile
</div>
</a>
<a title="Credits &amp; Subscriptions" tabindex="-1" class="nav-panel__item js-navigation-button" href="/my_account/credits"><ql-icon class='nav-panel__item__icon'>
money
</ql-icon>
<div class='nav-panel__item__label'>
Credits &amp; Subscriptions
</div>
</a>
<a title="Security" tabindex="-1" class="nav-panel__item js-navigation-button" href="/my_account/security"><ql-icon class='nav-panel__item__icon'>
security
</ql-icon>
<div class='nav-panel__item__label'>
Security
</div>
</a>
<div class='nav-panel__spacer'></div>
<a class="nav-panel__item" tabindex="-1" href="#"><ql-help>
<div class='nav-panel__help-item'>
<ql-icon class='nav-panel__item__icon'>help</ql-icon>
<div class='nav-panel__item__label'>Help</div>
</div>
</ql-help>
</a><div class='nav-panel__small-links'>
<a tabindex="-1" href="/privacy_policy">Privacy</a>
<a tabindex="-1" href="/terms_of_service">Terms</a>
</div>
</nav>
<div class='nav-panel__overlay js-nav-toggle'></div>

<main class='js-main'>
<span class='hidden' id='flash-sibling-before'></span>

<div class='l-main-wrapper' id='main-wrapper'>







<div class='js-lab-state' data-analytics-payload='{&quot;label&quot;:&quot;Continuous Delivery Pipelines with Spinnaker and Kubernetes Engine&quot;,&quot;lab_name&quot;:&quot;Continuous Delivery Pipelines with Spinnaker and Kubernetes Engine&quot;,&quot;classroom_name&quot;:null,&quot;deployment&quot;:&quot;run&quot;}' data-focus-id='552' data-lab-billing-limit='0.0' data-lab-duration='5400' data-parent='catalog' data-payment-required></div>
<ql-lab-control-panel class='js-lab-control-panel l-lab-control-panel' connectionDetails='[]' connectionFiles='[]' labControlButton='{&quot;disabled&quot;:false,&quot;pending&quot;:false,&quot;running&quot;:false}' labTimer='{&quot;ticking&quot;:false,&quot;secondsRemaining&quot;:5400}' studentResources='[]'></ql-lab-control-panel>
<div class='l-lab-main-body'>
<div class='js-lab-content lab-content'>
<div class='alert alert--fake js-alert'>
<p class='alert__message js-alert-message'></p>
<a class='alert__close js-alert-close'>
<i class='fa fa-times'></i>
</a>
<iframe class='l-ie-iframe-fix'></iframe>
</div>
<div class='lab-content__markdown-wrapper'>
<div class='lab-preamble'>
<h1 class='lab-preamble__title'>
Continuous Delivery Pipelines with Spinnaker and Kubernetes Engine
</h1>
<div class='lab-preamble__details subtitle-headline-1'>
<span>1 hour 30 minutes</span>
<span>9 Credits</span>
<div class='lab__rating'>
<a href="/focuses/552/reviews?parent=catalog"><div class='rateit' data-rateit-readonly='true' data-rateit-value='4.2081'></div>

</a><a data-target='#lab-review-modal' data-toggle='modal'>
Rate Lab
</a>
</div>
</div>
</div>

<div class='lab-content__inner-wrapper'>
<div class='js-markdown-instructions lab-content__markdown markdown-lab-instructions' id='markdown-lab-instructions'>



<h2 id="step1">GSP114</h2>
<p><img alt="Google Cloud Self-Paced Labs" src="https://cdn.qwiklabs.com/GMOHykaqmlTHiqEeQXTySaMXYPHeIvaqa2qHEzw6Occ%3D"></p>

<p>This hands-on lab shows you how to create a continuous delivery pipeline using Google Kubernetes Engine, Google Cloud Source Repositories, Google Cloud Container Builder, and Spinnaker. After you create a sample application, you configure these services to automatically build, test, and deploy it. When you modify the application code, the changes trigger the continuous delivery pipeline to automatically rebuild, retest, and redeploy the new version.</p>
<h2 id="step2">Objectives</h2>
<ul>
<li>
<p>Set up your environment by launching  <a href="https://cloud.google.com/shell/">Google Cloud Shell</a>, creating a Kubernetes Engine cluster, and configuring your identity and user management scheme.</p>
</li>
<li>
<p>Download a sample application, create a Git repository then upload it to a Google Cloud Source Repository.</p>
</li>
<li>
<p>Deploy Spinnaker to Kubernetes Engine using  <a href="https://github.com/kubernetes/helm">Helm</a>.</p>
</li>
<li>
<p>Build your Docker image.</p>
</li>
<li>
<p>Create triggers to create Docker images when your application changes.</p>
</li>
<li>
<p>Configure a Spinnaker pipeline to reliably and continuously deploy your application to Kubernetes Engine.</p>
</li>
<li>
<p>Deploy a code change, triggering the pipeline, and watch it roll out to production.</p>
</li>
</ul>
<h2 id="step3">Pipeline architecture</h2>
<p>To continuously deliver application updates to your users, you need an automated process that reliably builds, tests, and updates your software. Code changes should automatically flow through a pipeline that includes artifact creation, unit testing, functional testing, and production rollout. In some cases, you want a code update to apply to only a subset of your users, so that it is exercised realistically before you push it to your entire user base. If one of these  <a href="https://martinfowler.com/bliki/CanaryRelease.html">canary</a> releases proves unsatisfactory, your automated procedure must be able to quickly roll back the software changes.</p>
<p><img alt="8cda078d8123f982.png" src="https://cdn.qwiklabs.com/3W%2FV9FteNU4TA%2BCcIV81TBodme5yGTuaxcf%2BR0NtcH4%3D"></p>
<p>With Kubernetes Engine and Spinnaker you can create a robust continuous delivery flow that helps to ensure your software is shipped as quickly as it is developed and validated. Although rapid iteration is your end goal, you must first ensure that each application revision passes through a gamut of automated validations before becoming a candidate for production rollout. When a given change has been vetted through automation, you can also validate the application manually and conduct further pre-release testing.</p>
<p>After your team decides the application is ready for production, one of your team members can approve it for production deployment.</p>
<h3>Application delivery pipeline</h3>
<p>In this lab you build the continuous delivery pipeline shown in the following diagram.</p>
<p><img alt="7a1802b4383b4905.png" src="https://cdn.qwiklabs.com/PJktFlNGrmyiEiLlnCrd%2B2r%2FggA3LaUDPQn5frY7ikc%3D"></p>
<h2 id="step4">Setup and Requirements</h2>
<h3>Qwiklabs setup</h3>
<h4>Before you click the Start Lab button</h4>
<p>Read these instructions. Labs are timed and you cannot pause them. The timer, which starts when you click <strong>Start Lab</strong>, shows how long Google Cloud resources will be made available to you.</p>
<p>This Qwiklabs hands-on lab lets you do the lab activities yourself in a real cloud environment, not in a simulation or demo environment. It does so by giving you new, temporary credentials that you use to sign in and access Google Cloud for the duration of the lab.</p>
<h4>What you need</h4>
<p>To complete this lab, you need:</p>
<ul>
<li>Access to a standard internet browser (Chrome browser recommended).</li>
<li>Time to complete the lab.</li>
</ul>
<p><strong>Note:</strong> If you already have your own personal Google Cloud account or project, do not use it for this lab.</p>
<p><strong>Note:</strong> If you are using a Pixelbook please open an Incognito window to run this lab.</p>

<h4>How to start your lab and sign in to the Google Cloud Console</h4>
<ol>
<li>
<p>Click the <strong>Start Lab</strong> button. If you need to pay for the lab, a pop-up opens for you to select your payment method.
On the left is a panel populated with the temporary credentials that you must use for this lab.</p>
<p><img alt="Open Google Console" src="https://cdn.qwiklabs.com/%2FtHp4GI5VSDyTtdqi3qDFtevuY014F88%2BFow%2FadnRgE%3D"></p>
</li>
<li>
<p>Copy the username, and then click <strong>Open Google Console</strong>.
The lab spins up resources, and then opens another tab that shows the <strong>Sign in</strong> page.</p>
<p><img alt="Sign in" src="https://cdn.qwiklabs.com/VkUIAFY2xX3zoHgmWqYKccRLwFrR4BfARLd5ojmlbhs%3D"></p>
<p><strong><em>Tip:</em></strong> Open the tabs in separate windows, side-by-side.</p>
<aside>
 If you see the <strong>Choose an account</strong> page, click <strong>Use Another Account</strong>.
<img alt="Choose an account" src="https://cdn.qwiklabs.com/eQ6xPnPn13GjiJP3RWlHWwiMjhooHxTNvzfg1AL2WPw%3D">
</aside>
</li>
<li>
<p>In the <strong>Sign in</strong> page, paste the username that you copied from the Connection Details panel. Then copy and paste the password.</p>
<p><strong><em>Important:</em></strong> You must use the credentials from the Connection Details panel. Do not use your Qwiklabs credentials. If you have your own Google Cloud account, do not use it for this lab (avoids incurring charges).</p>
</li>
<li>
<p>Click through the subsequent pages:</p>
<ul>
<li>Accept the terms and conditions.</li>
<li>Do not add recovery options or two-factor authentication (because this is a temporary account).</li>
<li>Do not sign up for free trials.</li>
</ul>
</li>
</ol>
<p>After a few moments, the Cloud Console opens in this tab.</p>
<aside>
<strong>Note:</strong> You can view the menu with a list of Google Cloud Products and Services by clicking the <strong>Navigation menu</strong> at the top-left.
<img alt="Cloud Console Menu" src="https://cdn.qwiklabs.com/9vT7xPlxoNP%2FPsK0J8j0ZPFB4HnnpaIJVCDByaBrSHg%3D">
</aside>

<h3>Activate Google Cloud Shell</h3>
<p>Google Cloud Shell is a virtual machine that is loaded with development tools. It offers a persistent 5GB home directory and runs on the Google Cloud.
Google Cloud Shell provides command-line access to your Google Cloud resources.</p>
<ol>
<li>
<p>In the Google Cloud Console, on the top right toolbar, click the <strong>Activate Cloud Shell</strong> button.</p>
<p><img alt="Cloud Shell icon" src="https://cdn.qwiklabs.com/vdY5e%2Fan9ZGXw5a%2FZMb1agpXhRGozsOadHURcR8thAQ%3D"></p>
</li>
<li>
<p>Click <strong>Continue</strong>.
<img alt="cloudshell_continue.png" src="https://cdn.qwiklabs.com/lr3PBRjWIrJ%2BMQnE8kCkOnRQQVgJnWSg4UWk16f0s%2FA%3D"></p>
</li>
</ol>
<p>It takes a few moments to provision and connect to the environment. When you are connected, you are already authenticated, and the project is set to your <em>PROJECT_ID</em>. For example:</p>
<p><img alt="Cloud Shell Terminal" src="https://cdn.qwiklabs.com/hmMK0W41Txk%2B20bQyuDP9g60vCdBajIS%2B52iI2f4bYk%3D"></p>
<p><strong>gcloud</strong> is the command-line tool for Google Cloud. It comes pre-installed on Cloud Shell and supports tab-completion.</p>
<p>You can list the active account name with this command:</p>
<pre><code>gcloud auth list&#x000A;</code></pre>
<p>Output:</p>
<pre><code class="language-output prettyprint">Credentialed accounts:&#x000A; - &lt;myaccount&gt;@&lt;mydomain&gt;.com (active)&#x000A;</code></pre>
<p>Example output:</p>
<pre><code class="language-Output prettyprint">Credentialed accounts:&#x000A; - google1623327_student@qwiklabs.net&#x000A;</code></pre>
<p>You can list the project ID with this command:</p>
<pre><code>gcloud config list project&#x000A;</code></pre>
<p>Output:</p>
<pre><code class="language-output prettyprint">[core]&#x000A;project = &lt;project_ID&gt;&#x000A;</code></pre>
<p>Example output:</p>
<pre><code class="language-Output prettyprint">[core]&#x000A;project = qwiklabs-gcp-44776a13dea667a6&#x000A;</code></pre>
<aside>
  For full documentation of <strong>gcloud</strong>, see <a href="https://cloud.google.com/sdk/gcloud" target="_blank">gcloud command-line tool overview</a>.

</aside>

<h2 id="step5">Set up your environment</h2>
<p>Configure the infrastructure and identities required for this lab. First you'll create a Kubernetes Engine cluster to deploy Spinnaker and the sample application.</p>
<ol>
<li>
<p>Set the default compute zone:</p>
</li>
</ol>
<pre><code>gcloud config set compute/zone us-central1-f&#x000A;</code></pre>
<ol start="2">
<li>
<p>Create a Kubernetes Engine using the Spinnaker tutorial sample application:</p>
</li>
</ol>
<pre><code>gcloud container clusters create spinnaker-tutorial \&#x000A;    --machine-type=n1-standard-2&#x000A;</code></pre>
<p>This deployment takes between <strong>five and ten minutes</strong> to complete. You may see a warning about default scopes that you can safely ignore as it has no impact on this lab. Wait for the deployment to complete before proceeding.</p>
<p>When completed you see a report detailing the name, location, version, ip-address, machine-type, node version, number of nodes and status of the cluster that indicates the cluster is running.</p>
<h3>Configure identity and access management</h3>
<p>Create a Cloud Identity Access Management (Cloud IAM) <a href="https://cloud.google.com/iam/docs/service-accounts" target="_blank">service account</a> to delegate permissions to Spinnaker, allowing it to store data in Cloud Storage. Spinnaker stores its pipeline data in Cloud Storage to ensure reliability and resiliency. If your Spinnaker deployment unexpectedly fails, you can create an identical deployment in minutes with access to the same pipeline data as the original.</p>
<p>Upload your startup script to a Cloud Storage bucket by following these steps:</p>
<ol start="3">
<li>
<p>Create the service account:</p>
</li>
</ol>
<pre><code>gcloud iam service-accounts create spinnaker-account \&#x000A;    --display-name spinnaker-account&#x000A;</code></pre>
<ol start="4">
<li>
<p>Store the service account email address and your current project ID in environment variables for use in later commands:</p>
</li>
</ol>
<pre><code>export SA_EMAIL=$(gcloud iam service-accounts list \&#x000A;    --filter="displayName:spinnaker-account" \&#x000A;    --format='value(email)')&#x000A;</code></pre>
<pre><code>export PROJECT=$(gcloud info --format='value(config.project)')&#x000A;</code></pre>
<ol start="5">
<li>
<p>Bind the <code>storage.admin</code> role to your service account:</p>
</li>
</ol>
<pre><code>gcloud projects add-iam-policy-binding $PROJECT \&#x000A;    --role roles/storage.admin \&#x000A;    --member serviceAccount:$SA_EMAIL&#x000A;</code></pre>
<ol start="6">
<li>
<p>Download the service account key. In a later step, you will install Spinnaker and upload this key to Kubernetes Engine:</p>
</li>
</ol>
<pre><code>gcloud iam service-accounts keys create spinnaker-sa.json \&#x000A;     --iam-account $SA_EMAIL&#x000A;</code></pre>
<p>(Output)</p>
<pre><code class="language-bash prettyprint">created key [12f224e036437704b91a571792462ca6fc4cd438] of type [json] as [spinnaker-sa.json] for [spinnaker-account@qwiklabs-gcp-gcpd-f5e16da10e5d.iam.gserviceaccount.com]&#x000A;</code></pre>
<h2 id="step6">Set up Cloud Pub/Sub to trigger Spinnaker pipelines</h2>
<ol>
<li>
<p>Create the Cloud Pub/Sub topic for notifications from Container Registry.</p>
</li>
</ol>
<pre><code>gcloud pubsub topics create projects/$PROJECT/topics/gcr&#x000A;</code></pre>
<ol start="2">
<li>
<p>Create a subscription that Spinnaker can read from to receive notifications of images being pushed.</p>
</li>
</ol>
<pre><code>gcloud pubsub subscriptions create gcr-triggers \&#x000A;    --topic projects/${PROJECT}/topics/gcr&#x000A;</code></pre>
<ol start="3">
<li>
<p>Give Spinnaker's service account permissions to read from the gcr-triggers subscription.</p>
</li>
</ol>
<pre><code>export SA_EMAIL=$(gcloud iam service-accounts list \&#x000A;    --filter="displayName:spinnaker-account" \&#x000A;    --format='value(email)')&#x000A;</code></pre>
<pre><code>gcloud beta pubsub subscriptions add-iam-policy-binding gcr-triggers \&#x000A;    --role roles/pubsub.subscriber --member serviceAccount:$SA_EMAIL&#x000A;</code></pre>
<h3>Test Completed Task</h3>
<p>Click <strong>Check my progress</strong> to verify your performed task. If you have successfully setup the environment, you will see an assessment score.</p>
<ql-activity-tracking step="1">
  Set up your environment
</ql-activity-tracking>
<h2 id="step7">Deploying Spinnaker using Helm</h2>
<p>In this section you use  <a href="https://github.com/kubernetes/helm" target="_blank">Helm</a> to deploy Spinnaker from the <a href="https://github.com/kubernetes/charts" target="_blank">Charts</a> repository. Helm is a package manager you can use to configure and deploy <a href="http://kubeapps.com" target="_blank">Kubernetes applications</a>.</p>
<h3>Install Helm</h3>
<ol>
<li>
<p>Download and install the <code>helm</code> binary:</p>
</li>
</ol>
<pre><code class="language-bash prettyprint">wget https://get.helm.sh/helm-v3.1.0-linux-amd64.tar.gz&#x000A;</code></pre>
<ol start="2">
<li>
<p>Unzip the file to your local system:</p>
</li>
</ol>
<pre><code>tar zxfv helm-v3.1.0-linux-amd64.tar.gz&#x000A;</code></pre>
<pre><code>cp linux-amd64/helm .&#x000A;</code></pre>
<ol start="3">
<li>
<p>Grant Helm the cluster-admin role in your cluster:</p>
</li>
</ol>
<pre><code>kubectl create clusterrolebinding user-admin-binding \&#x000A;    --clusterrole=cluster-admin --user=$(gcloud config get-value account)&#x000A;</code></pre>
<ol start="4">
<li>
<p>Grant Spinnaker the <code>cluster-admin</code> role so it can deploy resources across all namespaces:</p>
</li>
</ol>
<pre><code>kubectl create clusterrolebinding --clusterrole=cluster-admin \&#x000A;    --serviceaccount=default:default spinnaker-admin&#x000A;</code></pre>
<ol start="5">
<li>
<p>Add the stable charts deployments to Helm's usable repositories (includes Spinnaker):</p>
</li>
</ol>
<pre><code>./helm repo add stable https://kubernetes-charts.storage.googleapis.com&#x000A;./helm repo update&#x000A;</code></pre>
<h3>Configure Spinnaker</h3>
<ol start="6">
<li>
<p>Still in Cloud Shell, create a bucket for Spinnaker to store its pipeline configuration:</p>
</li>
</ol>
<pre><code>export PROJECT=$(gcloud info \&#x000A;    --format='value(config.project)')&#x000A;</code></pre>
<pre><code>export BUCKET=$PROJECT-spinnaker-config&#x000A;</code></pre>
<pre><code>gsutil mb -c regional -l us-central1 gs://$BUCKET&#x000A;</code></pre>
<ol start="7">
<li>
<p>Run the following command to create a <code>spinnaker-config.yaml</code> file, which describes how Helm should install Spinnaker:</p>
</li>
</ol>
<pre><code>export SA_JSON=$(cat spinnaker-sa.json)&#x000A;export PROJECT=$(gcloud info --format='value(config.project)')&#x000A;export BUCKET=$PROJECT-spinnaker-config&#x000A;cat &gt; spinnaker-config.yaml &lt;&lt;EOF&#x000A;gcs:&#x000A;  enabled: true&#x000A;  bucket: $BUCKET&#x000A;  project: $PROJECT&#x000A;  jsonKey: '$SA_JSON'&#x000A;&#x000A;dockerRegistries:&#x000A;- name: gcr&#x000A;  address: https://gcr.io&#x000A;  username: _json_key&#x000A;  password: '$SA_JSON'&#x000A;  email: 1234@5678.com&#x000A;&#x000A;# Disable minio as the default storage backend&#x000A;minio:&#x000A;  enabled: false&#x000A;&#x000A;# Configure Spinnaker to enable GCP services&#x000A;halyard:&#x000A;  additionalScripts:&#x000A;    create: true&#x000A;    data:&#x000A;      enable_gcs_artifacts.sh: |-&#x000A;        \$HAL_COMMAND config artifact gcs account add gcs-$PROJECT --json-path /opt/gcs/key.json&#x000A;        \$HAL_COMMAND config artifact gcs enable&#x000A;      enable_pubsub_triggers.sh: |-&#x000A;        \$HAL_COMMAND config pubsub google enable&#x000A;        \$HAL_COMMAND config pubsub google subscription add gcr-triggers \&#x000A;          --subscription-name gcr-triggers \&#x000A;          --json-path /opt/gcs/key.json \&#x000A;          --project $PROJECT \&#x000A;          --message-format GCR&#x000A;EOF&#x000A;</code></pre>
<h3>Deploy the Spinnaker chart</h3>
<ol start="8">
<li>
<p>Use the Helm command-line interface to deploy the chart with your configuration set:</p>
</li>
</ol>
<pre><code>./helm install -n default cd stable/spinnaker -f spinnaker-config.yaml \&#x000A;           --version 1.23.0 --timeout 10m0s --wait&#x000A;</code></pre>
<ql-infobox>
The installation typically takes <b>5-8 minutes</b> to complete.
</ql-infobox>
<ol start="9">
<li>
<p>After the command completes, run the following command to set up port forwarding to Spinnaker from Cloud Shell:</p>
</li>
</ol>
<pre><code>export DECK_POD=$(kubectl get pods --namespace default -l "cluster=spin-deck" \&#x000A;    -o jsonpath="{.items[0].metadata.name}")&#x000A;</code></pre>
<pre><code>kubectl port-forward --namespace default $DECK_POD 8080:9000 &gt;&gt; /dev/null &amp;&#x000A;</code></pre>
<ol start="10">
<li>To open the Spinnaker user interface, click the <strong>Web Preview</strong> icon at the top of the Cloud Shell window and select <strong>Preview on port 8080</strong>.</li>
</ol>
<p><img alt="bde9fe42e27656fb.png" src="https://cdn.qwiklabs.com/a6YnJv8GlGae4rnJIbjA27J8c7YApa%2B6noPFkkKxZjk%3D"></p>
<p>The welcome screen opens, followed by the Spinnaker user interface:</p>
<p><img alt="8c03705c17bf3b7f.png" src="https://cdn.qwiklabs.com/78xnSiBC3%2B6wTlFb3dk%2FPGGw0%2BWMeBhMVkQpnHfWFiY%3D"></p>
<p>Leave this tab open, this is where you'll access the Spinnaker UI.</p>
<h3>Test Completed Task</h3>
<p>Click <strong>Check my progress</strong> to verify your performed task. If you have successfully deployed the Spinnaker chart using Kubernetes Helm, you will see an assessment score.</p>
<ql-activity-tracking step="2">
  Deploy the Spinnaker chart using Kubernetes Helm
</ql-activity-tracking>
<h2 id="step8">Building the Docker image</h2>
<p>In this section, you configure Cloud Build to detect changes to your app source code, build a Docker image, and then push it to Container Registry.</p>
<h3>Create your source code repository</h3>
<ol>
<li>
<p>In Cloud Shell tab and download the sample application source code:</p>
</li>
</ol>
<pre><code>wget https://gke-spinnaker.storage.googleapis.com/sample-app-v2.tgz&#x000A;</code></pre>
<ol start="2">
<li>
<p>Unpack the source code:</p>
</li>
</ol>
<pre><code>tar xzfv sample-app-v2.tgz&#x000A;</code></pre>
<ol start="3">
<li>
<p>Change directories to the source code:</p>
</li>
</ol>
<pre><code>cd sample-app&#x000A;</code></pre>
<ol start="4">
<li>
<p>Set the username and email address for your Git commits in this repository. Replace <code>[USERNAME]</code> with a username you create:</p>
</li>
</ol>
<pre><code>git config --global user.email "$(gcloud config get-value core/account)"&#x000A;</code></pre>
<pre><code>git config --global user.name "[USERNAME]"&#x000A;</code></pre>
<ol start="5">
<li>
<p>Make the initial commit to your source code repository:</p>
</li>
</ol>
<pre><code>git init&#x000A;</code></pre>
<pre><code>git add .&#x000A;</code></pre>
<pre><code>git commit -m "Initial commit"&#x000A;</code></pre>
<ol start="6">
<li>
<p>Create a repository to host your code:</p>
</li>
</ol>
<pre><code>gcloud source repos create sample-app&#x000A;</code></pre>
<ql-infobox>
<p>Disregard the "you may be billed for this repository" message.</p>
</ql-infobox>
<pre><code class="language-bash prettyprint">git config credential.helper gcloud.sh&#x000A;</code></pre>
<ol start="7">
<li>
<p>Add your newly created repository as remote:</p>
</li>
</ol>
<pre><code>export PROJECT=$(gcloud info --format='value(config.project)')&#x000A;</code></pre>
<pre><code>git remote add origin https://source.developers.google.com/p/$PROJECT/r/sample-app&#x000A;</code></pre>
<ol start="8">
<li>
<p>Push your code to the new repository's master branch:</p>
</li>
</ol>
<pre><code>git push origin master&#x000A;</code></pre>
<ol start="9">
<li>Check that you can see your source code in the Console by clicking <strong>Navigation Menu</strong> &gt; <strong>Source Repositories</strong>.</li>
</ol>
<p><img alt="nav-source-repo.png" src="https://cdn.qwiklabs.com/y1jULn3nMeoUGcf1aBnSZ7u9KT5HLYqIhd%2FGa78LbtY%3D"></p>
<ol start="10">
<li>Click <strong>View All Repositories</strong> and select <strong>sample-app</strong>.</li>
</ol>
<p><img alt="source-repo.png" src="https://cdn.qwiklabs.com/r2BMszyuyimucqRYkLOpNqc1FMXQ9W9VXxt2hXnSeO0%3D"></p>
<h3>Configure your build triggers</h3>
<p>Configure Container Builder to build and push your Docker images every time you push <a href="https://git-scm.com/book/en/v2/Git-Basics-Tagging" target="_blank">Git tags</a> to your source repository. Container Builder automatically checks out your source code, builds the Docker image from the Dockerfile in your repository, and pushes that image to Google Cloud Container Registry.</p>
<p><img alt="bcab2f07975c8776.png" src="https://cdn.qwiklabs.com/5mt%2Fk3dCd%2FgfYPln9TjLQoZkjh%2FZiiOnBWQ5MLLJVyI%3D"></p>
<ol start="11">
<li>
<p>In the Cloud Platform Console, click <strong>Navigation menu</strong> &gt; <strong>Cloud Build</strong> &gt; <strong>Triggers</strong>.</p>
</li>
<li>
<p>Click <strong>Create trigger</strong>.</p>
</li>
</ol>
<p><img alt="CloudBuild_BuildTriggers.png" src="https://cdn.qwiklabs.com/ZYUwl%2BcDxAArWV1hG08gJoFIOIuImwfe0N4H025tubQ%3D"></p>
<ol start="13">
<li>
<p>Select your newly created <code>sample-app</code> repository.</p>
</li>
<li>
<p>Set the following trigger settings:</p>
</li>
</ol>
<ul>
<li>
<p><strong>Name</strong>:<code>sample-app-tags</code></p>
</li>
<li>
<p><strong>Trigger type</strong>: Tag</p>
</li>
<li>
<p><strong>Tag (regex)</strong>: <code>v.*</code></p>
</li>
<li>
<p><strong>Build configuration</strong>: <code>Cloud Build configuration file (yaml or json)</code></p>
</li>
<li>
<p><strong>Cloud Build configuration file location</strong>: <code>/cloudbuild.yaml</code></p>
</li>
</ul>
<ol start="15">
<li>Click <strong>Create trigger</strong>.</li>
</ol>
<p><img alt="create_trigger_console.png" src="https://cdn.qwiklabs.com/KtgAPQ961epEObg%2FYeb0EnGhv6dpGbOZryI0c5251Iw%3D"></p>
<p>From now on, whenever you push a Git tag prefixed with the letter "v" to your source code repository, Container Builder automatically builds and pushes your application as a Docker image to Container Registry.</p>
<h3>Prepare your Kubernetes Manifests for use in Spinnaker</h3>
<p>Spinnaker needs access to your Kubernetes manifests in order to deploy them to your clusters. This section creates a Cloud Storage bucket that will be populated with your manifests during the CI process in Cloud Build. After your manifests are in Cloud Storage, Spinnaker can download and apply them during your pipeline's execution.</p>
<ol start="16">
<li>
<p>Create the bucket:</p>
</li>
</ol>
<pre><code>export PROJECT=$(gcloud info --format='value(config.project)')&#x000A;</code></pre>
<pre><code>gsutil mb -l us-central1 gs://$PROJECT-kubernetes-manifests&#x000A;</code></pre>
<ol start="17">
<li>
<p>Enable versioning on the bucket so that you have a history of your manifests:</p>
</li>
</ol>
<pre><code>gsutil versioning set on gs://$PROJECT-kubernetes-manifests&#x000A;</code></pre>
<ol start="18">
<li>
<p>Set the correct project ID in your kubernetes deployment manifests:</p>
</li>
</ol>
<pre><code>sed -i s/PROJECT/$PROJECT/g k8s/deployments/*&#x000A;</code></pre>
<ol start="19">
<li>
<p>Commit the changes to the repository:</p>
</li>
</ol>
<pre><code>git commit -a -m "Set project ID"&#x000A;</code></pre>
<h3>Build your image</h3>
<p>Push your first image using the following steps:</p>
<ol start="20">
<li>
<p>In Cloud Shell, still in the <code>sample-app</code> directory, create a Git tag:</p>
</li>
</ol>
<pre><code>git tag v1.0.0&#x000A;</code></pre>
<ol start="21">
<li>
<p>Push the tag:</p>
</li>
</ol>
<pre><code>git push --tags&#x000A;</code></pre>
<p>(output)</p>
<pre><code class="language-bash prettyprint">To https://source.developers.google.com/p/qwiklabs-gcp-ddf2925f84de0b16/r/sample-app&#x000A;* [new tag]      v1.0.0 -&gt; v1.0.0&#x000A;</code></pre>
<ol start="22">
<li>Go to the GCP Console. Still in Cloud Build, click <strong>History</strong> in the left pane to check that the build has been triggered. If not, verify that the trigger was configured properly in the previous section.</li>
</ol>
<p><img alt="CloudBuild_BuildHistory.png" src="https://cdn.qwiklabs.com/hOy0rerMcmxMDs8Qs23dG2ZPGIzt78TOV9adkp1M5dQ%3D"></p>
<p><strong>Stay on this page and wait</strong> for the build to complete before going on to the next section.</p>
<h3>Test Completed Task</h3>
<p>Click <strong>Check my progress</strong> to verify your performed task. If you have successfully build the Docker image, you will see an assessment score.</p>
<ql-activity-tracking step="3">
  Build the Docker image
</ql-activity-tracking>
<h2 id="step9">Configuring your deployment pipelines</h2>
<p>Now that your images are building automatically, you need to deploy them to the Kubernetes cluster.</p>
<p>You deploy to a scaled-down environment for integration testing. After the integration tests pass, you must manually approve the changes to deploy the code to production services.</p>
<h3>Install the spin CLI for managing Spinnaker</h3>
<p><a href="https://www.spinnaker.io/guides/spin/cli/" target="_blank">spin</a> is a command-line utility for managing Spinnaker's applications and pipelines.</p>
<ol>
<li>
<p>Download the 1.14.0 version of <code>spin</code>:</p>
</li>
</ol>
<pre><code>curl -LO https://storage.googleapis.com/spinnaker-artifacts/spin/1.14.0/linux/amd64/spin&#x000A;</code></pre>
<ol start="2">
<li>
<p>Make <code>spin</code> executable:</p>
</li>
</ol>
<pre><code>chmod +x spin&#x000A;</code></pre>
<h3>Create the deployment pipeline</h3>
<ol start="3">
<li>
<p>Use spin to create an app called sample in Spinnaker. Set the owner email address for the app in Spinnaker:</p>
</li>
</ol>
<pre><code>./spin application save --application-name sample \&#x000A;                        --owner-email "$(gcloud config get-value core/account)" \&#x000A;                        --cloud-providers kubernetes \&#x000A;                        --gate-endpoint http://localhost:8080/gate&#x000A;</code></pre>
<p>Next, you create the continuous delivery pipeline. In this tutorial, the pipeline is configured to detect when a Docker image with a tag prefixed with "v" has arrived in your Container Registry.</p>
<ol start="4">
<li>
<p>From your <code>sample-app</code> source code directory, run the following command to upload an example pipeline to your Spinnaker instance:</p>
</li>
</ol>
<pre><code>export PROJECT=$(gcloud info --format='value(config.project)')&#x000A;sed s/PROJECT/$PROJECT/g spinnaker/pipeline-deploy.json &gt; pipeline.json&#x000A;./spin pipeline save --gate-endpoint http://localhost:8080/gate -f pipeline.json&#x000A;</code></pre>
<h3>Manually Trigger and View your pipeline execution</h3>
<p>The configuration you just created uses notifications of newly tagged images being pushed to trigger a Spinnaker pipeline. In a previous step, you pushed a tag to the Cloud Source Repositories which triggered Cloud Build to build and push your image to Container Registry. To verify the pipeline, <code>manually trigger</code> it.</p>
<ol start="5">
<li>In the Spinnaker UI and click <strong>Applications</strong> at the top of the screen to see your list of managed applications. <strong>sample</strong> is your application. If you don't see <strong>sample</strong>, try refreshing the Spinnaker Applications tab.</li>
</ol>
<p><img alt="app-sample.png" src="https://cdn.qwiklabs.com/l1SLrdit4XYqd636IlNhYubL13Y3jvvOO7AvQ2Df0DA%3D"></p>
<ol start="6">
<li>Click <strong>sample</strong> to view your application deployment.</li>
<li>Click <strong>Pipelines</strong> at the top to view your applications pipeline status.</li>
<li>Click <strong>Start Manual Execution</strong> to trigger the pipeline this first time.</li>
</ol>
<p><img alt="start-man-ex.png" src="https://cdn.qwiklabs.com/WSy8LMXa74ovYfYogBCA6J%2FXzQ77Qjp4jKIyX8jpa9o%3D"></p>
<ol start="9">
<li>
<p>Click <strong>Run</strong>.</p>
</li>
<li>
<p>Click <strong>Execution Details</strong> to see more information about the pipeline's progress.</p>
</li>
</ol>
<p><img alt="man-start-detail.png" src="https://cdn.qwiklabs.com/ZJXzykscsE1mOzsubdbDgPBWisZN%2BkV1Sj7LITrikF8%3D"></p>
<p>The progress bar shows the status of the deployment pipeline and its steps.</p>
<p><img alt="progress-bar.png" src="https://cdn.qwiklabs.com/t%2BWtKxCdqL8czxdWYVvy%2BM2Cuqi7DcUbj5c6OR6k9OA%3D"></p>
<p>Steps in blue are currently running, green ones have completed successfully, and red ones have failed.</p>
<ol start="11">
<li>Click a stage to see details about it.</li>
</ol>
<p>After <strong>3 to 5 minutes</strong> the integration test phase completes and the pipeline requires manual approval to continue the deployment.</p>
<ol start="12">
<li>Hover over the yellow "person" icon and click <strong>Continue</strong>.</li>
</ol>
<p><img alt="continue-to-deploy.png" src="https://cdn.qwiklabs.com/1eDinR4BooeXbRTiOJTyKtvh2nWTkJWX4ddhhiyFuYk%3D"></p>
<p>Your rollout continues to the production frontend and backend deployments. It completes after a few minutes.</p>
<ol start="13">
<li>To view the app, select <strong>Infrastructure</strong> &gt; <strong>Load Balancers</strong> in the top of the Spinnaker UI.</li>
</ol>
<p><img alt="infrasturcture-lb.png" src="https://cdn.qwiklabs.com/ans47fs3%2B2qcS6gjsDvYb3WW6%2BoRUX4RhLKCIIum7NA%3D"></p>
<ol start="14">
<li>
<p>Scroll down the list of load balancers and click Default, under <code>service sample-frontend-production</code>.</p>
</li>
<li>
<p>Scroll down the details pane on the right and copy your app's IP address by clicking the clipboard button on the <strong>Ingress</strong> IP. The ingress IP link from the Spinnaker UI may use HTTPS by default, while the application is configured to use HTTP.</p>
</li>
</ol>
<p><img alt="ingress.png" src="https://cdn.qwiklabs.com/q%2BkaykoQWgcrCfZtJ%2B7amfMqq0qguh%2B8rFDcpl1C2sI%3D"></p>
<ol start="16">
<li>Paste the address into a new browser tab to view the application.  You might see the canary version displayed, but if you refresh you will also see the production version.</li>
</ol>
<p><img alt="5350848ad1354d1c.png" src="https://cdn.qwiklabs.com/VteuqPqhtXAAocO0DyXy2QM%2B%2BPbOGMyXs114MYCVIHI%3D"></p>
<p>You have now manually triggered the pipeline to build, test, and deploy your application.</p>
<h3>Test Completed Task</h3>
<p>Click <strong>Check my progress</strong> to verify your performed task. If you have successfully created service load balancers, you will see an assessment score.</p>
<ql-activity-tracking step="4">
  Create service load balancers
</ql-activity-tracking>
<h3>Test Completed Task</h3>
<p>Click <strong>Check my progress</strong> to verify your performed task. If you have successfully deployed an image to production, you will see an assessment score.</p>
<ql-activity-tracking step="5">
  Deploy an image to production
</ql-activity-tracking>
<h2 id="step10">Triggering your pipeline from code changes</h2>
<p>Now test the pipeline end to end by making a code change, pushing a Git tag, and watching the pipeline run in response. By pushing a Git tag that starts with "v", you trigger Container Builder to build a new Docker image and push it to Container Registry. Spinnaker detects that the new image tag begins with "v" and triggers a pipeline to deploy the image to canaries, run tests, and roll out the same image to all pods in the deployment.</p>
<ol>
<li>
<p>From your sample-app directory, change the color of the app from orange to blue:</p>
</li>
</ol>
<pre><code>sed -i 's/orange/blue/g' cmd/gke-info/common-service.go&#x000A;</code></pre>
<ol start="2">
<li>
<p>Tag your change and push it to the source code repository:</p>
</li>
</ol>
<pre><code>git commit -a -m "Change color to blue"&#x000A;</code></pre>
<pre><code>git tag v1.0.1&#x000A;</code></pre>
<pre><code>git push --tags&#x000A;</code></pre>
<ol start="3">
<li>
<p>In the Console, in <strong>Cloud Build</strong> &gt; <strong>History</strong>, wait a couple of minutes for the new build to appear. You may need to refresh your page. Wait for the new build to complete, before going to the next step.</p>
</li>
<li>
<p>Return to the Spinnaker UI and click <strong>Pipelines</strong> to watch the pipeline start to deploy the image. The automatically triggered pipeline will take a few minutes to appear. You may need to refresh your page.</p>
</li>
</ol>
<p><img alt="d006977feef1a15d.png" src="https://cdn.qwiklabs.com/zTxZCs10j1jYtRzTBKH8XTzaTCiqO2UdtDyg7%2BqQ2c4%3D"></p>
<h3>Test Completed Task</h3>
<p>Click <strong>Check my progress</strong> to verify your performed task. If you have successfully triggered pipeline from code changes, you will see an assessment score.</p>
<ql-activity-tracking step="6">
  Triggering pipeline from code changes
</ql-activity-tracking>
<h2 id="step11">Observe the canary deployments</h2>
<ol>
<li>
<p>When the deployment is paused, waiting to roll out to production, return to the web page displaying your running application and start refreshing the tab that contains your app. Four of your backends are running the previous version of your app, while only one backend is running the canary. You should see the new, blue version of your app appear about every fifth time you refresh.</p>
</li>
<li>
<p>When the pipeline completes, your app looks like the following screenshot. Note that the color has changed to blue because of your code change, and that the <strong>Version</strong> field now reads <code>canary</code>.</p>
</li>
</ol>
<p><img alt="Blue_Application_Output.png" src="https://cdn.qwiklabs.com/h9zibqT3MUXBu8FWjVE%2B07ZdbXMaGFsmMCLKgALX8nE%3D"></p>
<p>You have now successfully rolled out your app to your entire production environment!</p>
<ol start="3">
<li>
<p>Optionally, you can roll back this change by reverting your previous commit. Rolling back adds a new tag (v1.0.2), and pushes the tag back through the same pipeline you used to deploy v1.0.1:</p>
</li>
</ol>
<pre><code>git revert v1.0.1&#x000A;</code></pre>
<pre><code>git tag v1.0.2&#x000A;</code></pre>
<pre><code>git push --tags&#x000A;</code></pre>
<ol start="4">
<li>When the build and then the pipeline completes, verify the roll back by clicking <strong>Infrastructure</strong> &gt; <strong>Load Balancers</strong>, then click the <strong>service sample-frontend-production</strong> <strong>Default</strong> and copy the Ingress IP address into a new tab.</li>
</ol>
<p>Now your app is back to orange and you can see the <code>production</code> version number.</p>
<p><img alt="revert.png" src="https://cdn.qwiklabs.com/LtAUqeMxVZbGZv4tBVncyhlMXO5JR9q7vN51oHPlNvU%3D"></p>
<h2 id="step12">Congratulations</h2>
<p>You have now successfully completed the Continuous Delivery Pipelines with Spinnaker and Kubernetes Engine lab.</p>
<p><img alt="bf1e2a23518ceceb.png" src="https://cdn.qwiklabs.com/t848PXcuZreVIPsXRDCDd6cdYSwCRWYxN4GhP2%2Bemwg%3D">
<img alt="DevOpsTransparent.png" src="https://cdn.qwiklabs.com/Bps%2BnktWjZhTqr%2F8%2FRFUEB2uCuqNUM%2Fkz8a%2BMEwKWE4%3D"></p>
<h3>Finish Your Quest</h3>
<p>This self-paced lab is part of the Qwiklabs <a href="https://google.qwiklabs.com/quests/36">Google Cloud Solutions I: Scaling Your Infrastructure</a> and <a href="https://google.qwiklabs.com/quests/96">DevOps Essentials</a> Quests. A Quest is a series of related labs that form a learning path. Completing this Quest earns you the badge above, to recognize your achievement. You can make your badge (or badges) public and link to them in your online resume or social media account. Enroll in a Quest and get immediate completion credit if you've taken this lab.  <a href="https://google.qwiklabs.com/catalog">See other available Qwiklabs Quests</a>.</p>
<h3>Take Your Next Lab</h3>
<p>Continue your Quest with  <a href="https://google.qwiklabs.com/focuses/11513">Running Dedicated Game Servers in Google Kubernetes Engine</a>, or check out these suggestions:</p>
<ul>
<li>
<p><a href="https://google.qwiklabs.com/catalog_lab/940">Deployment Manager - Full Production</a></p>
</li>
<li>
<p><a href="https://google.qwiklabs.com/catalog_lab/1583">Site Reliability Troubleshooting with Stackdriver APM</a></p>
</li>
</ul>
<h3>Next Steps / Learn More</h3>
<ul>
<li><a href="https://cloud.google.com/solutions/continuous-delivery-jenkins-kubernetes-engine">Learn about Continuous Deployment with Jenkins</a></li>
<li><a href="https://cloud.google.com/solutions/spinnaker-on-compute-engine">Learn about Deploying Spinnaker to Compute Engine</a></li>
<li><a href="https://cloud.google.com/solutions/jenkins-on-kubernetes-engine-tutorial">Deploy Jenkins to Kubernetes Engine</a></li>
<li><a href="https://cloud.google.com/solutions/ansible-with-spinnaker-tutorial">Use Spinnaker with Ansible to Do Continuous Delivery</a></li>
</ul>
<h3>Google Cloud Training &amp; Certification</h3>
<p>...helps you make the most of Google Cloud technologies. <a href="https://cloud.google.com/training/courses" target="_blank">Our classes</a> include technical skills and best practices to help you get up to speed quickly and continue your learning journey. We offer fundamental to advanced level training, with on-demand, live, and virtual options to suit your busy schedule. <a href="https://cloud.google.com/certification/" target="_blank">Certifications</a> help you validate and prove your skill and expertise in Google Cloud technologies.</p>

<h5>Manual Last Updated: February 20, 2020</h5>
<h5>Lab Last Tested: February 20, 2020</h5>
<p>Copyright 2020 Google LLC All rights reserved. Google and the Google logo are trademarks of Google LLC. All other company and product names may be trademarks of the respective companies with which they are associated.</p>



</div>
<div class='js-lab-content-outline lab-content__outline'>
<a href='#step1'>GSP114</a><a href='#step2'>Objectives</a><a href='#step3'>Pipeline architecture</a><a href='#step4'>Setup and Requirements</a><a href='#step5'>Set up your environment</a><a href='#step6'>Set up Cloud Pub/Sub to trigger Spinnaker pipelines</a><a href='#step7'>Deploying Spinnaker using Helm</a><a href='#step8'>Building the Docker image</a><a href='#step9'>Configuring your deployment pipelines</a><a href='#step10'>Triggering your pipeline from code changes</a><a href='#step11'>Observe the canary deployments</a><a href='#step12'>Congratulations</a>
</div>
</div>

</div>

<div class='lab-content__markdown-wrapper'>
<div class='lab-content__markdown'>
<div class='lab-content__recommendation'>
<!-- # TODO: Change classes so that this doesn't stack vertically -->
<section class='upcoming-cards'>
<h2 class='headline-3'>Continue questing</h2>
<div class='content-card-grid'>
<div class='card-content-wrapper js-content-card' data-id='1583' data-level='Advanced' data-name='Site Reliability Troubleshooting with Cloud Monitoring APM' data-type='Lab'>
<a class="card card--content elevation-0 content-lab" href="/focuses/4186?parent=catalog"><div class='card__image'>
<div class='card__image__inner' style='background-image: url(https://cdn.qwiklabs.com/assets/fractal1-90735da7b9906552121e230998c46ac7e2e5f943f2c909a6da76f50d7e815976.jpg)'></div>
</div>
<div class='card__body'>
<div class='overline card--content__type'>
Hands-On Lab
</div>
<h3 class='card--content__title'>
Site Reliability Troubleshooting with Cloud Monitoring APM
</h3>
<p class='card--content__description body-1'>
The objective of this lab is to familiarize yourself with the specific capabilities of Cloud Monitoring to monitor GKE cluster infrastructure, Istio, and applications deployed on this infrastructure.
</p>
</div>
<div class='card__footer'>
<div class='card__footer__left'>
<span>Advanced</span>
</div>
<div class='card__footer__right'>
<div class='rateit' data-rateit-readonly='true' data-rateit-value='3.9271'></div>
</div>
</div>
</a></div>

</div>
</section>

</div>
</div>
</div>

</div>
</div>
<div class='lab-assessment__tab js-lab-assessment-tab'>
<h5 class='small-label'>
Score
</h5>
<h3 class='js-lab-assessment-total-score'>
&mdash;/100
</h3>
<iframe class='l-ie-iframe-fix'></iframe>
</div>
<div class='lab-assessment__panel js-lab-assessment-panel'>
<!-- / If lab_instance has is started and assessment is generated, use -->
<!-- / lab_instance.assessment, otherwise use lab.assessment_manual -->
<div class='lab-assessment__step'>
<p class='lab-assessment__step__title'>
Set up your environment
</p>
<p class='button button--assessment js-show-run-step-button' step_no='1'>
Run Step
</p>
<p class='lab-assessment__step__score'>
<span class='js-assessment-step-score-1'>
</span>
/ 10
</p>
</div>

<div class='lab-assessment__step'>
<p class='lab-assessment__step__title'>
Deploy the Spinnaker chart using Kubernetes Helm
</p>
<p class='button button--assessment js-show-run-step-button' step_no='2'>
Run Step
</p>
<p class='lab-assessment__step__score'>
<span class='js-assessment-step-score-2'>
</span>
/ 20
</p>
</div>

<div class='lab-assessment__step'>
<p class='lab-assessment__step__title'>
Building the Docker image
</p>
<p class='button button--assessment js-show-run-step-button' step_no='3'>
Run Step
</p>
<p class='lab-assessment__step__score'>
<span class='js-assessment-step-score-3'>
</span>
/ 20
</p>
</div>

<div class='lab-assessment__step'>
<p class='lab-assessment__step__title'>
Create service load balancers
</p>
<p class='button button--assessment js-show-run-step-button' step_no='4'>
Run Step
</p>
<p class='lab-assessment__step__score'>
<span class='js-assessment-step-score-4'>
</span>
/ 20
</p>
</div>

<div class='lab-assessment__step'>
<p class='lab-assessment__step__title'>
Deploy an image to production
</p>
<p class='button button--assessment js-show-run-step-button' step_no='5'>
Run Step
</p>
<p class='lab-assessment__step__score'>
<span class='js-assessment-step-score-5'>
</span>
/ 10
</p>
</div>

<div class='lab-assessment__step'>
<p class='lab-assessment__step__title'>
Triggering pipeline from code changes
</p>
<p class='button button--assessment js-show-run-step-button' step_no='6'>
Run Step
</p>
<p class='lab-assessment__step__score'>
<span class='js-assessment-step-score-6'>
</span>
/ 20
</p>
</div>

<iframe class='l-ie-iframe-fix'></iframe>
</div>
<div class='lab-introduction js-lab-introduction is-hidden'>
<div class='lab-introduction__inner'>
<h1 class='headline-1'>Welcome to Your First Lab!</h1>
<ql-icon-button class='js-skip-button'>close</ql-icon-button>
<div class='lab-introduction__video'>
<iframe allow='autoplay; encrypted-media' allowfullscreen frameborder='0' id='lab-introduction' src='https://www.youtube.com/embed/yF7EDXKTmoQ?enablejsapi=1&amp;rel=0&amp;showinfo=0'></iframe>
</div>
<a class='js-skip-button button button--outline'>Skip this video</a>
</div>
</div>



</div>
</main>
<div class='modal fade' id='lab-details-modal'>
<div class='modal-container'>
<div class='mdl-shadow--24dp modal-content'>
<div class='modal-body'>
<p class='l-mbm'>
Create a Kubernetes Engine cluster, deploy an application, and use Spinnaker to continuously deploy the application when changes are made to the application.
</p>
<p>
This lab is included in these quests:
<a href="/quests/24">Cloud Architecture</a>, <a href="/quests/96">DevOps Essentials</a>, <a href="/quests/36">Google Cloud Solutions I: Scaling Your Infrastructure</a>.
If you complete this lab you&#39;ll receive credit for it when you enroll in one of these quests.
</p>
<p class='small-label l-mbs'>
<strong>
Duration:
</strong>
0m setup
&middot;
90m access
&middot;
90m completion
</p>
<p class='small-label l-mbs'>
<span><strong>Levels: </strong>expert</span>
</p>
<p class='small-label'>
<strong>
Permalink:
</strong>
<a href="https://www.qwiklabs.com/catalog_lab/744">https://www.qwiklabs.com/catalog_lab/744</a>
</p>
</div>
<div class='modal-actions'>
<a class='mdl-button mdl-button--primary mdl-js-button mdl-js-ripple-effect' data-dismiss='modal'>
Got It
</a>
</div>


</div>
</div>
<iframe class='l-ie-iframe-fix'></iframe>
</div>
<div class='modal fade' id='lab-review-modal'>
<div class='modal-container'>
<div class='mdl-shadow--24dp modal-content'>
<form class="simple_form js-lab-review-form" id="edit_lab_review_5429452" action="/lab_reviews/5429452" accept-charset="UTF-8" data-remote="true" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><input type="hidden" name="_method" value="patch" /><div class='modal-body'>
<p class='label'>
How satisfied are you with this lab?*
</p>
<div class='rateit js-rateit' data-rateit-max='5' data-rateit-min='0' data-rateit-resetable='false' data-rateit-step='1' data-rateit-value='5'></div>
<div class='l-mtm'>

<div class="control-group hidden lab_review_user_id"><div class="controls"><input class="hidden" type="hidden" value="2485272" name="lab_review[user_id]" id="lab_review_user_id" /></div></div>
<div class="control-group hidden lab_review_classroom_id"><div class="controls"><input class="hidden" type="hidden" name="lab_review[classroom_id]" id="lab_review_classroom_id" /></div></div>
<div class="control-group hidden lab_review_lab_id"><div class="controls"><input class="hidden" type="hidden" value="744" name="lab_review[lab_id]" id="lab_review_lab_id" /></div></div>
<div class="control-group hidden lab_review_focus_id"><div class="controls"><input class="hidden" type="hidden" name="lab_review[focus_id]" id="lab_review_focus_id" /></div></div>
<div class="control-group hidden lab_review_rating"><div class="controls"><input class="hidden js-rating-input" type="hidden" value="2" name="lab_review[rating]" id="lab_review_rating" /></div></div>
<div class="control-group text optional lab_review_comment"><label class="text optional control-label" for="lab_review_comment">Comment</label><div class="controls"><textarea class="text optional" name="lab_review[comment]" id="lab_review_comment">
</textarea></div></div>
</div>
</div>
<div class='modal-actions'>
<a class='mdl-button mdl-button--primary mdl-js-button mdl-js-ripple-effect' data-dismiss='modal'>
Cancel
</a>
<input type="submit" name="commit" value="Submit" disabled="disabled" class="btn mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--primary" id="submit" data-disabled="false" data-disable-with="Submit" />
</div>
</form>

</div>
</div>
<iframe class='l-ie-iframe-fix'></iframe>
</div>
<div class='modal fade' id='lab-access-modal'>
<div class='modal-container'>
<div class='mdl-shadow--24dp modal-content'>
<a class='lab-access-modal-close' data-analytics-action='dismissed_lab_payment_modal' data-dismiss='modal'>
<i class='material-icons'>close</i>
</a>
<form class="js-lab-access-form" action="/lab_onetime_coupons/activate?parent=catalog" accept-charset="UTF-8" data-remote="true" method="post"><input name="utf8" type="hidden" value="&#x2713;" />
<div class='modal-body'>
<div class='lab-access-modal'>
<input type="hidden" name="id" id="id" value="552" />
<input type="hidden" name="user_id" id="user_id" value="2485272" />
<input type="hidden" name="launch_with_credits" id="launch_with_credits" value="0" class="js-launch-with-credits-input" />
<input type="hidden" name="launch_with_subs" id="launch_with_subs" value="0" class="js-launch-with-subscription-input" />
<div class='lab-access-modal__method'>
<p>
This lab costs
9 Credits.
</p>
<p>
You have a valid subscription package. Would you like to charge this lab to your subscription?

</p>
<a class='button js-launch-with-subscription-button js-lab-access-modal-button' data-analytics-action='clicked_launch_with_subscription_button'>
Use Subscription
</a>
</div>
<div class='lab-access-modal__method'>
<p>
Enter Lab Access Code:
</p>
<div class='lab-access-modal__code js-access-code'>
<input type="text" name="uuid_1" id="uuid_1" value="" maxlength="4" placeholder="1234" />
<input type="text" name="uuid_2" id="uuid_2" value="" maxlength="4" placeholder="1234" />
<input type="text" name="uuid_3" id="uuid_3" value="" maxlength="4" placeholder="1234" />
<input type="text" name="uuid_4" id="uuid_4" value="" maxlength="4" placeholder="1234" />
</div>
<a class='button js-launch-with-access-code-button js-lab-access-modal-button' data-analytics-action='clicked_launch_with_access_code_button'>
Launch with Access Code
</a>
</div>
</div>
</div>
</form>



</div>
</div>
<iframe class='l-ie-iframe-fix'></iframe>
</div>

<script>
  $( function() {
    ql.initMaterialInputs();
    initChosen();
    initSearch();
    initTabs();
    ql.list.init();
    ql.favoriting.init();
    ql.header.myAccount.init();
    initTooltips();
    ql.autocomplete.init();
    ql.modals.init();
    ql.toggleButtons.init();
    ql.analytics.init();
    initLabContent( );
  ql.labOutline.links.init();
  ql.labOutline.layout.init();
  initLabReviewModal();
  initLabAccessModal();
  ql.labAssessment.init();
  ql.labIntroduction.init( true );
  ql.labData.init();
  initLabTranslations( {"are_you_sure":"All done? If you end this lab, you will lose all your work. You may not be able to restart the lab if there is a quota limit. Are you sure you want to end this lab?\n","in_progress":"*In Progress*","ending":"*Ending*","starting":"*Starting, please wait*","end_concurrent_labs":"Sorry, you can only run one lab at a time. To start this lab, please confirm that you want all of your existing labs to end.\n","copied":"Copied","no_resource":"Error retrieving resource.","no_support":"No Support","mac_press":"Press ‚åò-C to copy","thanks_review":"Thanks for reviewing this lab.","windows_press":"Press Ctrl-C to copy","days":"days"} );
  ql.labRun.init();
  ql.initHeader();
  ql.navigation.init();
  ql.navPanel.init();
  ql.navigation.init();
  
  });
</script>
<style>
  .mdl-layout__container {
    position: static
  }
</style>
</body>
</html>
